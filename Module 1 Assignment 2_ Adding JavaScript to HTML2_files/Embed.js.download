"use strict";(Panopto=Panopto||{}).PlayerJsFlowplayerAdapter=function(e,t){(t=t||{}).loadCallback=t.loadCallback||$.noop;var i=new playerjs.Receiver(["play","pause","timeupdate","seeked","ended","error"],["play","pause","mute","unmute","getDuration","getPaused","getMuted","getVolume","setVolume","getCurrentTime","setCurrentTime","getLoop","setLoop"]);i.on("play",(function(){e.ready?_.defer((function(){e.resume()})):t.loadCallback()})),i.on("pause",(function(){_.defer((function(){e.pause()}))})),i.on("mute",(function(){e.mute(!0)})),i.on("unmute",(function(){e.mute(!1)})),i.on("getDuration",(function(t){e.ready?t(e.video.duration):e.on("ready",(function(){t(e.video.duration)}))})),i.on("getPaused",(function(t){t(e.paused)})),i.on("getMuted",(function(t){t(e.muted)})),i.on("getVolume",(function(t){t(100*e.volumeLevel)})),i.on("setVolume",(function(t){e.volume(t/100)})),i.on("getCurrentTime",(function(t){t(e.video.time)})),i.on("setCurrentTime",(function(t){e.seek(t)}));var o=!1;return i.on("getLoop",(function(e){e(o)})),i.on("setLoop",(function(e){o=e})),e.on("ready",(function(){i.emit("play")})),e.on("pause",(function(){i.emit("pause")})),e.on("resume",(function(){i.emit("play")})),e.on("progress",(function(){i.eventListeners.timeupdate&&i.emit("timeupdate",{seconds:e.video.time,duration:e.video.duration})})),e.on("seek",(function(){i.emit("seeked")})),e.on("finish",(function(){i.emit("ended"),o&&e.resume()})),e.on("error",(function(){i.emit("error")})),i},(Panopto=Panopto||{}).Branding=Panopto.Branding||{};const renderBrandingStyleElement=$("<style />").appendTo("head");var Panopto,PanoptoTS;Panopto.Branding.createLogo=function(e,t,i){var o={svgUrl:t.svg??Panopto.branding.svgLogo,pngUrl:t.png,width:t.svgWidth,height:t.svgHeight,mainLogoToolTip:Panopto.GlobalResources.Everything,customerLogoLink:Panopto.branding.siteLogoLink,cobrandLink:"https://www.panopto.com",cobrandString:Panopto.GlobalResources.PanoptoLogo_PoweredBy,listPageLink:PanoptoTS.StringHelpers.format("{0}/Pages/Sessions/List.aspx",Panopto.appRoot),linksEnabled:i,showCobrand:Panopto.branding.showCobrand},a=_.template($("#customerLogoTemplate").html())(o),s=_.template($("#panoptoLogoTemplate").html())(o);e.html(o.pngUrl&&-1===o.pngUrl.indexOf("_branding")?s:a)},Panopto.Branding.renderBrandingColors=function(e,t){const i=new PanoptoCore.Color(e),o=i.toHex(),a=i.getSafety().toHex(),s=i.getSafety().multiply(.9).toHex(),n=i.getSafety().multiply(.8).toHex();var r,l,d,p=[{selector:".accent-color",styleChanges:["color: {0}","border-color: {0}"]},{selector:".selected.accent-left-border",styleChanges:["border-left-color: {0}"]},{selector:".embedded-plugin#batchUpload #sessionList .session.selected .session-check.accent-button",styleChanges:["background-color: {0}"]},{selector:".accent-background",styleChanges:["background-color: {0}"]},{selector:".selected.accented-tab",styleChanges:["border-left-color: {0}"]},{selector:".MuiSwitch-root .Mui-checked .MuiIconButton-label",styleChanges:["color: {0}"]},{selector:".MuiSwitch-root .Mui-checked + .MuiSwitch-track",styleChanges:["background-color: {0}"]},{selector:".MuiSwitch-colorSecondary.Mui-checked",styleChanges:["color: {0}"]}],h=[{selector:".content-table table .selected .highlight-cell",styleChanges:["background-color: {0}"]},{selector:".selected.accent-left-border a",styleChanges:["border-left-color: {0}"]},{selector:".selected .accent-button",styleChanges:["border-color: {0}"]},{selector:".selected.accented-tab",styleChanges:["background-color: {0}"]},{selector:".safety-accent-border",styleChanges:["border-color: {0}"]},{selector:".safety-background",styleChanges:["background-color: {0}"]},{selector:".safety-text",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.highlighted .event-text",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.editing .event-text",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.highlighted .event-time",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.editing .event-time",styleChanges:["color: {0}"]},{selector:".event-tab-pane .match",styleChanges:["color: {0}"]},{selector:".safety-border",styleChanges:["border-color: {0}"]},{selector:".colored-scroll-button",styleChanges:["color: {0}"]},{selector:".selected.branded-border",styleChanges:["border-color: {0}"]}];t?p.push({selector:".safety-accent-border-ifcustom",styleChanges:["border-color: {0}"]}):h.push({selector:".safety-accent-border-ifcustom",styleChanges:["border-color: {0}"]});var c=function(e,t){return{selector:e,styleChanges:[PanoptoTS.StringHelpers.format("background-color: {0}",t),PanoptoTS.StringHelpers.format("border-color: {0}",t)]}};function u(e){_.each(e.styleChanges,(function(t){$.rule(e.selector+"{"+t+" !important}").appendTo(renderBrandingStyleElement)}))}function g(e,t){_.each(e,(function(e){u(e=function(e,t){return e.styleChanges=_.map(e.styleChanges,(function(e){return PanoptoTS.StringHelpers.format(e,t)})),e}(e,t))}))}r=c(".branded-button",a),l=c(".branded-button:hover:not(.disabled)",s),d=c(".branded-button:active:not(.disabled)",n),g(p,o),g(h,a),g([{selector:".embedded-plugin#batchUpload #sessionList .session.selected .session-check.accent-button:hover",styleChanges:["background-color: {0}"]},{selector:".embedded-plugin#batchUpload .create-upload:hover .create-upload-icon.image-accent-background",styleChanges:["background-color: {0}"]}],s),u(r),u(l),u(d);const m=function(e){if(!/^#[0-9a-f]{6}$/.test(e))return[];const t=e.substr(1,2),i=e.substr(3,2),o=e.substr(5,2);return[parseInt(t,16).toString(),parseInt(i,16).toString(),parseInt(o,16).toString()]}(o);[{selector:".MuiSwitch-colorSecondary.Mui-checked:hover",styleChanges:["background-color: {0}"],alpha:.04}].forEach((e=>{e.styleChanges=e.styleChanges.map((t=>PanoptoTS.StringHelpers.format(t,function(e){if(!m.length)return;if(e>1||e<0)return;const t=e.toString();return`rgba(${m[0]}, ${m[1]}, ${m[2]}, ${t})`}(e.alpha)))),u(e)}))},Panopto.Branding.brandElements=function(e){const t=new PanoptoCore.Color(e),i=t.toHex(),o=t.getSafety().toHex();Panopto.Branding.brandImageBackgrounds(".image-accent-background",".image-accent-background",i),Panopto.Branding.animateLoadingIndicator(o)},Panopto.Branding.animateLoadingIndicator=function(e){Panopto.Core.UI.Components.spinner($("#loadingMessage")),Panopto.Core.UI.Components.spinner($("#primaryBuffering")),Panopto.Core.UI.Components.spinner($("#secondaryBuffering")),Panopto.Core.UI.Components.spinner($(".logging-out-spinner")),Panopto.Core.UI.Components.spinner($(".logging-in-spinner")),Panopto.Core.UI.Components.spinner($("#modalSpinner")),Panopto.Core.UI.Components.spinner($(".event-tab-spinner")),Panopto.Branding.brandImageBackgrounds(".branded-animation",".spinner-background",e),$("#navBar .browse-spinner #path").css("fill",e)},Panopto.Branding.brandImageBackground=function(e,t){-1!==t.indexOf("_branding")&&e.css("background-image","url("+t+")")},Panopto.Branding.brandImageBackgroundRule=function(e,t){var i=-1!==t.indexOf("_branding");return i&&$.rule(e+"{background-image: url("+t+") !important}").appendTo(renderBrandingStyleElement),i},Panopto.Branding.brandImageBackgrounds=function(e,t,i){var o=_.filter(_.map($(e),(function(e){var t=$(e).css("background-image");return t&&(t=t.replace(/^url|[\(\")]/g,"")),t})),(function(e){return"none"!==e})),a=o.length,s=function(e){e||$.rule(t+"{background-color:"+i+" !important}").appendTo(renderBrandingStyleElement)};s(a),_.each(o,(function(e){var t=new Image,i=function(){a--,s(a)};t.onload=i,t.onerror=i,t.src=e}))},function(e){!function(t){let i=Panopto.Core.StringHelpers,o=Panopto.Core.Key;const a=PanoptoCore.Logging.Logger,s={trackPlayedColor:"rgba(255, 255, 255, 0.8)",trackPlayedActiveColor:"#FFF",trackBackgroundColor:"transparent",trackBorderColor:"rgba(255, 255, 255, 0.3)",labelFontColor:"#FFF",labelBackgroundColor:"rgba(0, 0, 0, 0.8)"},n=new PanoptoCore.Logging.LoggingContext("Embed.ts");class r{get autoHideEnabled(){let e=this.initParams.IsAudioOnly&&$(window).height()<r.hoverCaptionsMinHeight&&this.captionsDisplayed;return this.autoHideRequested||e}constructor(t){this.iPhoneReturnFromFullscreenPlaying=!1,this.downloadEnabled=!1,this.positionListeners=[],this.processingPingIntervalMsec=Panopto.features.embedProcessingStatusIntervalMsec,this.checkCopyrightNoticeRequirement=$.Deferred(),this.checkBlockingLTIQuiz=$.Deferred(),this.invocationRequested=!1,this.audioDescriptionsActivated=!1,this.eventOverlayShown=!1,this.menuOpen=!1,this.nativeFullscreen=!1,this._selectedCaptionSetting="selectedCaptionSetting",this._selectedAudioDescriptionSetting="selectedAudioDescriptionSetting",this.wasRenderCalled=!1,this.handleEmbedApiCommand=async e=>{switch(e.msg){case"iframePlay":{const e=this.flowplayer?this.flowplayer.muted:this.timelineState?.muted??!1;await this.ensurePlayAllowed({muted:e})&&this.resume();break}case"iframePause":this.pause();break;case"iframeMute":this.mute(!0);break;case"iframeUnmute":await this.prepareForUnmute(),this.mute(!1);break;case"iframeSpeed":this.requestSpeed(e.floatData);break;case"iframeSeek":this.requestSeek(e.floatData);break;case"iframeVolume":this.setVolume(e.floatData);break;case"iframeLoad":await this.ensurePlayAllowed({muted:this.startMuted})&&this.loadVideo();break;case"iframeStop":this.stop();break;case"iframeCaptionsOn":if(this.nonNativeCaptionsAvailable){let t=!1;if(!isNaN(e.intData)){const i=this.initParams.AvailableLanguages[e.intData];this.timelineController&&(this.getCaptions(this.deliveryId,this.inviteId,i).then((()=>this.toggleCaptions(!0))),this.selectedCaption=i,this.timelineNavigationControls?.setProps({captionsLanguage:this.selectedCaption}),t=!0)}t||this.toggleCaptions(!0)}break;case"iframeCaptionsOff":this.nonNativeCaptionsAvailable&&(this.toggleCaptions(!1),this.timelineNavigationControls?.setProps({captionsLanguage:void 0}));break;case"iframeBitrate":this.setBitrate(e.intData)}},this.handleFullViewerButtonActivated=()=>{if(!this.fullViewerLinkEnabled)return;this.isLiveBroadcast?(this.flowplayer&&this.flowplayer.mute(!0,!0),this.timelineController&&this.timelineController.muted(!0)):(this.flowplayer&&this.flowplayer.pause(),this.timelineController&&this.timelineController.pause());let e=0;this.flowplayer&&(e=this.flowplayer.video.time),this.timelineController&&(e=this.timelineState.timelinePosition||0);const t=this.playlistId?`&pid=${this.playlistId}`:"";window.open(`${this.initParams.ViewerLink}${t}&start=${e}`)},Panopto.MicrosoftTeamsUtils?.closePopoverLoginPageInTeamsApp(),PanoptoCore.Helpers.applyFullpage(),PanoptoViewer.configure({hlsJsConfig:Panopto.viewer.hlsJsConfig,flowplayerKey:t.PlayerKey,serverAuthoritativeLeadingEvents:Panopto.features.serverAuthoritativeLeadingEvents,enableTextTrackCaptionSource:Panopto.viewer.enableTextTrackCaptionSource,enableReactQuiz:Panopto.viewer.enableReactQuiz,defaultMBRBitrate:Panopto.viewer.defaultMBRBitrate,enableSecureCdn:Panopto.viewer.enableSecureCdn}),this.viewerLogging=new PanoptoViewer.ViewerLogging(Panopto.globalServicesFQDN),this.initParams=t,this.initParams.AvailableLanguages=this.initParams.AvailableLanguages?.map((e=>null===e?void 0:e)),this.sessionListUrl=`${Panopto.uriScheme}://${Panopto.webServerFQDN}${Panopto.appRoot}/Pages/Sessions/List.aspx`,this.defaultThumbnailUrl=`${Panopto.cacheRoot}/Images/no_thumbnail.svg`,this.loginUrl=String.format(this.initParams.LoginUrl,encodeURIComponent(window.location.href));let o=i.parseQueryString(location.search,!0,!0);this.interactivity="none"===o.interactivity||"false"===o.interactivity?"none":"search"===o.interactivity?"search":"all",this.hideOverlay=i.parseBoolean(o.hideoverlay);const a=i.parseBoolean(o.remoteembed),s=o.remotehost,n=o.embedapiid,l="MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;let d=!!PanoptoCore.Browser.$_mobile||l,p=!!(PanoptoCore.Browser.$_ipad||PanoptoCore.Browser.$_iphone||PanoptoCore.Browser.$_ipod)||l,h=i.parseBoolean(o.iosapp),c=i.parseBoolean(o.androidapp),u=i.parseBoolean(o.videopreview),g=i.parseBoolean(o.panoptomobile),m=h||c||g;const y=!(m||p&&!PanoptoCore.Browser.$_safari);let v=o.query,P=this.initParams.IsLiveBroadcast;this.isLiveBroadcast=P;let b=this.ensureMobileCompatibleManifest(this.initParams.VideoUrl),C=i.parseBoolean(o.advance),f=i.parseBoolean(o.autoplay)&&Panopto.features.autoPlayEnabled||C,w=!("showtitle"in o)||i.parseBoolean(o.showtitle),S=o.showbrand?i.parseBoolean(o.showbrand):Panopto.features.brandEmbedViewer;this.scormEnabled=o.isscorm;const k=!(!Panopto.teamsApp?.isFromTeams||!PanoptoCore.Browser.isMobileOrTablet),D=(_.isUndefined(o.offerviewer)||i.parseBoolean(o.offerviewer))&&!i.parseBoolean(o.internal)&&(!d||PanoptoCore.Browser.inIframe()&&!PanoptoCore.Helpers.fullscreenEnabled)&&!this.scormEnabled||k;let T,A,I=o.start?parseFloat(o.start):void 0,E="true"===o.legacylti,V="true"===o.gradable;V&&(E?T={outcomeId:o.outcome_did,oauthConsumerKey:o.oauth_consumer_key,outcomeServiceUrl:o.lis_outcome_service_url}:A={deliveryId:o.id,providerId:o.providerid,lti13LineItemUrl:o.lti13lineitemurl,ltiUserId:o.ltiuserid});let L=(_.isUndefined(o.autohide)||i.parseBoolean(o.autohide))&&!this.initParams.IsAudioOnly,R=(PanoptoCore.Helpers.fullscreenEnabled||p)&&!this.initParams.IsAudioOnly&&!m&&!this.hideOverlay,B=!!this.initParams.CaptionUrl&&this.initParams.CaptionUrl.length>0,M=PanoptoCore.getUserSetting("embedCaptions"),U=_.isUndefined(o.captions)?void 0:i.parseBoolean(o.captions),O="boolean"==typeof M?M:"boolean"==typeof U?U:Panopto.captionSettings.enabledDefault,F=B&&O;const x=this.initParams.VRType>PanoptoViewer.MediaVRType.None,H=this.initParams.EnableEmbedMultistream&&!x,N=!P||H,q=N?Panopto.viewer.seekAndVspBehavior:"no-seeking";let z=PanoptoCore.getUserSetting("defaultEmbedVolume");"number"!=typeof z&&(z=r.maxVolume);let G=parseFloat(o.playspeed);G=N&&-1!==r.playbackSpeeds.indexOf(G)?G:PanoptoViewer.PlaySpeed.Normal;let Q=i.parseBoolean(o.starttourmuted),W=r.flowplayerGlobal.support.volume&&(0===z||Q),j=Panopto.Core.UI.Components.CopyrightNotice($("#copyrightNoticeContainer"),this.initParams.CopyrightNoticeText,this.initParams.CopyrightNoticeAutoDismissDuration,Panopto.viewer.allowInsecureHTMLTagsInCopyrightAndPolicyTexts);this.deliveryId=this.initParams.DeliveryId,this.sessionId=this.initParams.SessionId,this.playlistId=o.pid,this.playlistDeliveryId=o.id,this.inviteId=o.tid,this.videoUrl=b,this.isMobile=d,this.isIos=p,this.isIosApp=h,this.isAndroidApp=c,this.isReactNativeApp=g,this.isApp=m,this.downloadSupported=y,this.hasBackButton=this.isIosApp||this.isReactNativeApp,this.isVideoPreview=u,this.playlistAdvance=C,this.autoPlayRequested=f,this.startMuted=W,this.startTourMutedQuery=Q,this.showTitle=w,this.showBrand=S,this.showFullViewerLink=D,this.ltiOutcomeConfig=T,this.ltiAgsConfig=A,this.isLegacyLti=E,this.autoHideRequested=L,this.isLiveBroadcast=P,this.fullscreenEnabled=R,this.nonNativeCaptionsAvailable=B,this.vspSupported=N,this.seekAndVspBehavior=q,this.isVR=x,this.remoteEmbed=a,this.remoteHost=s,this.embedApiId=n,this.isLTIContext=V,this.ltiCourseId=o.lticourseid,this.enableMultistream=H,this.ltiEmbedHeight=o.ltiembedheight,this.defaultLayout=this.convertPodcastTypeToLayout(this.initParams.podcastLayout),this.startQueryParam=I,this.initialVolume=z,this.initialPlaySpeed=G,this.initialSearchTerm=v,this.player=$("#player"),this.eventOverlayElement=$("#eventOverlay, #eventOverlayGutter"),this.copyrightNotice=j,this.shouldDisplayCaptionsInitially=O,this.captionsDisplayed=F,this.captionsStyles=new PanoptoCore.Models.Settings.CaptionStyles(PanoptoCore.getUserSetting("defaultCaptionPlacement")??PanoptoCore.Models.Settings.CaptionPlacement.Docked,PanoptoCore.getUserSetting("defaultCaptionSize")??PanoptoCore.Models.Settings.CaptionSize.Regular,PanoptoCore.getUserSetting("defaultCaptionColor")??"LightOnDark"),this.nonNativeCaptionsAvailable&&(this.selectedCaption=PanoptoCore.getUserSetting(this._selectedCaptionSetting),this.availableLanguagesFriendly=this.initParams.AvailableLanguages?.map((e=>e?PanoptoCore.ContentLanguageFriendly[PanoptoCore.ContentLanguage[e]]:Panopto.GlobalResources.Admin_Captions_NoLanguage)),-1===this.initParams.AvailableLanguages.indexOf(this.selectedCaption)&&(this.selectedCaption=this.initParams.AvailableLanguages[0])),this.configureOrientationListener(),this.deliveryRefreshTimer=new PanoptoViewer.Controllers.DeliveryRefreshTimer(this.deliveryId,this.inviteId,!1,!0,!1,!1,(t=>{const i=6===this.initParams.podcastLayout&&!this.initParams.EnableEmbedMultistreamOverrideTileMode&&!this.initParams.IsLiveBroadcast,o=!PanoptoCore.Helpers.fullscreenEnabled&&Panopto.viewer.forceVideoPodcastOnMSE,a=new RegExp(Panopto.viewer.mobileBroadcastUserAgentRegex,"i").test(navigator.userAgent),s=this.isLiveBroadcast&&a;return new e.Viewer.Data.Delivery(t,i||o,s)}),(e=>{PanoptoViewer.AudioDescriptionPlayer.initializeSpeechSynthesisVoices().then((()=>{this.initializeAudioDescriptions(),this.setDelivery(e);let t=!!this.isLTIContext&&!!this.quizzes.length;this.fullViewerLinkEnabled=D&&!t||k,this.checkForBlockingLTIQuiz(),this.render()}))}),(e=>{window.location.reload()}),(e=>{this.updateBroadcast(e)}),(()=>{window.location.reload()}),(()=>{this.wasRenderCalled||this.render()})),$((()=>{(PanoptoViewer.enableSecureCdn()?PanoptoViewer.Controllers.enableSignedUrl(this.deliveryId):Promise.resolve()).then((()=>{this.deliveryRefreshTimer.start()})),this.ltiEmbedHeight&&window.parent.postMessage(JSON.stringify({subject:"lti.frameResize",height:this.ltiEmbedHeight-9}),"*")}))}convertPodcastTypeToLayout(e){return void 0!==PanoptoViewer.PlayerLayoutMode[e]?e:PanoptoViewer.PlayerLayoutMode.Normal}getCaptions(e,t,i){let o=$.Deferred();return PanoptoViewer.Services.getCaptions(e,t,i).then((e=>{const t=e.map((e=>({text:e.Caption||"",time:e.Time,endTime:e.CaptionDuration&&Panopto.viewer.enableCaptionEndTimeInViewer?e.Time+e.CaptionDuration:void 0}))),s=PanoptoCore.ContentLanguage[i]||"[default language]";a.info(n.formatMessageWithContext("getCaptions",`Received ${t.length} captions for ${s}`)),this.timelineController&&t.length>0&&(o.resolve(t),this.timelineController.updateCaptions(t))})).catch((()=>{a.error(n.formatMessageWithContext("getCaptions","Failed to fetch captions")),o.reject()})),o.promise()}getAudioDescriptions(e,t,i){const o=$.Deferred();return PanoptoViewer.Services.getAudioDescriptions(e,t,i).then((e=>{const t=e.map((e=>({text:e.Caption||"",time:e.Time,language:i}))),s=PanoptoCore.ContentLanguage[i]||"[default language]";a.info(n.formatMessageWithContext("getAudioDescriptions",`Received ${t.length} audio descriptions for ${s}`)),this.timelineController&&t.length?(o.resolve(t),this.timelineController.updateAudioDescriptions(t)):o.resolve([])})).catch((()=>{a.error(n.formatMessageWithContext("getAudioDescriptions","Failed to fetch audio descriptions")),o.reject()})),o.promise()}submitClientLog(){if(!this.invocationId)return void a.warning(n.formatMessageWithContext("submitClientLog","Attempted to submit logs without an invocation ID"));const e={InvocationId:this.invocationId,Entries:[`SessionId: ${this.delivery.sessionId}`,...this.viewerLogging.retrieveLogs()]};Panopto.Core.ServiceInterface.WCFRest.DataCS.submitViewerClientLog(e,(e=>{this.viewerLogging.showDialog(e)}),(()=>{alert(Panopto.GlobalResources.ViewerPlus_LogsError)}))}setDelivery(e){let t=Panopto.Core.PlayResumption.calculateStartTime(e.lastViewingPosition,e.duration);if(this.delivery=e,this.downloadUrl=e.downloadUrl,this.downloadEnabled=!!this.downloadUrl&&this.downloadSupported,this.quizzes=_.filter(e.documents,(e=>e.isQuiz)),this.showFullViewerLink=this.showFullViewerLink&&!e.isPurgedEncode,this.timelineSeekHelper=new PanoptoViewer.TimelineSeekHelper(this.delivery.duration,this.seekAndVspBehavior,this.isLiveBroadcast),e.completionPercentage&&this.reportPercentCompleted(e.completionPercentage),this.scormEnabled)try{this.scormControl=new PanoptoViewer.Scorm.ScormControl(this.reportPercentCompleted.bind(this),this.delivery.duration),t=this.scormControl.lastPosition,this.updateScormProgress()}catch(e){a.error(n.formatMessageWithContext("setDelivery","Error initializing ScormControl."),e)}void 0!==this.startQueryParam?this.startTime=this.timelineSeekHelper.getValidPosition(this.startQueryParam)??t:this.startTime=t;const i=Math.max(...[...e.primaryStreams,...e.secondaryStreams].map((e=>e.variants.length)));this.qualityCount=Math.min(i,PanoptoCore.mapEnum(PanoptoViewer.MBRBitrate,(e=>e)).length-1)}reportPercentCompleted(e){const t=Math.min((e-1)/100,1)*this.delivery.duration;this.timelineSeekHelper.updateFurthestWatchedPoint(t),"all-seeking"!==this.seekAndVspBehavior&&Panopto.viewer.enableSeekAndVspAfterPercentage>0&&Panopto.viewer.enableSeekAndVspAfterPercentage<e&&(this.seekAndVspBehavior="all-seeking",this.timelineSeekHelper.enableSeekAndVsp(),this.timelineSeekHelper.updateDuration(this.delivery.duration),this.enableSeekAndVspControls())}checkWebcastEnded(e,t){(this.delivery.broadcastInterrupted||this.delivery.broadcastEnded)&&e&&t?($("#broadcastStatus").text(this.delivery.broadcastInterrupted?Panopto.GlobalResources.Embed_BroadcastInterrupted:Panopto.GlobalResources.Embed_BroadcastEnded),$("#broadcastStatusWrapper").show()):$("#broadcastStatusWrapper").hide()}checkForApiStateChange(e){this.hasPlaybackRateChanged(e)&&(this.sendApiStateUpdate("iframeSpeedUpdate"),this.sendReactNativeStateUpdate()),this.timelineState.paused!==e.paused&&(this.sendApiStateUpdate("iframeStateUpdate"),this.sendReactNativeStateUpdate()),this.timelineState.timelinePosition===e.timelinePosition&&this.timelineState.muted===e.muted&&this.timelineState.volume===e.volume||(this.sendApiStateUpdate(void 0),this.sendReactNativeStateUpdate())}hasPlaybackRateChanged(e){return this.timelineState&&e.playbackRate!==this.timelineState.playbackRate}handleTimelineControllerStateChanged(e){this.timelineSeekHelper.updateFurthestWatchedPoint(e.timelinePosition),this.timelineSeekHelper.updateDuration(e.duration);const t=this.hasPlaybackRateChanged(e);this.timelineState?.isLive!==e.isLive&&a.verbose(n.formatMessageWithContext("handleTimelineControllerStateChanged",`isLive changed to ${e.isLive}`));const i=this.timelineState;this.timelineState=e,this.checkForApiStateChange(i),t&&this.loggerSpeedChangeHandler&&this.loggerSpeedChangeHandler(),this.isLiveBroadcast&&this.checkWebcastEnded(e.paused||e.isBuffering,this.isPositionAtTheEnd(e.timelinePosition,e.duration));const o=this.timelineSeekHelper.getValidPlaySpeed(e.playbackRate,e.timelinePosition);void 0!==o&&o!==e.playbackRate&&this.setSpeed(o);{let t=Panopto.GlobalResources[e.muted?"Embed_Muted":"Embed_Unmuted"];$("#muteButton").attr("title",t)}if(this.player.toggleClass("is-muted",e.muted),i.volume!==e.volume||i.muted!==e.muted){const t=e.muted?0:100*e.volume;this.setVolumeCookie(t),this.isMobile||($("#volumeSlider").slider("value",t),$("#volumeLevel").css("width",t+"%"))}this.player.toggleClass("is-playing",!e.paused),i.paused&&!e.paused&&this.showControls(r.playDisplayDuration),e.isBuffering!==i.isBuffering&&a.info(n.formatMessageWithContext("handleTimelineControllerStateChanged",`isBuffering changed to ${e.isBuffering}`)),!i.paused&&e.paused&&this.showControls(!0),this.timelineLayoutControls?.setProps({timelineState:e}),$("#title").toggleClass("has-layout-controls",e.availableSecondaryCount>0),this.timelineSeekBar?.setProps({timelineState:e});const s=this.nonNativeCaptionsAvailable||PanoptoViewer.getEnableTextTrackCaptionSource()&&e.availableLanguages.length>0,l=this.initParams.EnableCaptionsSettingsEnhancements||s?s?"visible":"disabled":"hidden";this.timelinePlaybackControls?.setProps({timelineState:e}),this.timelineMobilePlaybackControls?.setProps({timelineState:e}),this.timelineNavigationControls?.setProps({timelineState:e,captionButtonMode:l});const d=isFinite(e.timelinePosition)?Panopto.Core.TimeHelpers.formatDuration(e.timelinePosition,":",!1,0,!1):"";$(".fp-elapsed").text(d),$(".fp-duration").text(Panopto.Core.TimeHelpers.formatDuration(e.duration,":",!1,0,!1)),$(".fp-remaining").text(Panopto.Core.TimeHelpers.formatDuration(e.duration-e.timelinePosition,":",!1,0,!1)),this.displaySpeed(e.playbackRate),e.activeSecondary instanceof PanoptoViewer.DocumentPlayer?$("#embed").toggleClass("show-interactivity",!1):$("#embed").toggleClass("show-interactivity","none"!==this.interactivity),this.isMobile&&e.isBuffering?$(".mobile-transport-controls .play").hide():$(".mobile-transport-controls .play").show(),this.positionListeners.forEach((t=>t(e.timelinePosition))),(e.timelinePosition>=e.duration||e.isEnded)&&(this.playlistId?this.playlistOverlay.queueNextItem():this.delivery.nextDelivery&&this.showNextDelivery())}configureTimelineControllerControls(){new PanoptoViewer.Controls.TimelineHotkeys((e=>{switch(this.showControls(r.controlDisplayDuration),e){case"togglePlayState":this.player.hasClass("is-ready")?this.togglePlayState():this.loadVideo();break;case"seekToBeginning":case"seekTo0Pct":this.requestSeekTo(0);break;case"seekToEnd":this.requestSeekTo(10);break;case"rewind":this.requestSeek(this.getPosition()-10);break;case"forward":this.requestSeek(this.getPosition()+10);break;case"seekTo10Pct":this.requestSeekTo(1);break;case"seekTo20Pct":this.requestSeekTo(2);break;case"seekTo30Pct":this.requestSeekTo(3);break;case"seekTo40Pct":this.requestSeekTo(4);break;case"seekTo50Pct":this.requestSeekTo(5);break;case"seekTo60Pct":this.requestSeekTo(6);break;case"seekTo70Pct":this.requestSeekTo(7);break;case"seekTo80Pct":this.requestSeekTo(8);break;case"seekTo90Pct":this.requestSeekTo(9);break;case"seekToPrevious":this.requestSeekTo();break;case"volumeUp":this.timelineController.volume(Math.min(this.timelineState.volume+.1,1));break;case"volumeDown":this.timelineController.volume(Math.max(this.timelineState.volume-.1,0));break;case"toggleMuted":this.timelineController.muted(!this.timelineState.muted);break;case"toggleFullscreen":this.toggleFullscreen();break;case"toggleCaption":this.nonNativeCaptionsAvailable&&this.activateCaptionsToggle();break;case"toggleAudioDescription":this.initParams.AvailableAudioDescriptionLanguages.length&&this.activateAudioDescriptionsToggle();break;case"playbackRateDown":this.requestSpeed(!1);break;case"playbackRateUp":this.requestSpeed(!0);break;case"cancel":this.menuOpen?(this.hideMenus(),this.playlistOverlay&&this.playlistOverlay.hide(),this.showControls(r.controlDisplayDuration)):this.autoHideEnabled?this.showControls(!1,{ignorePlayState:!0}):Panopto.Core.ElementHelpers.blurActiveElement()}}));$("#overlay").append("<div class='layout-container'></div>"),this.timelineLayoutControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineLayoutControls)($(".layout-container")[0],{resources:Panopto.GlobalResources,timelineState:this.timelineState,onCycleSecondaryRequested:()=>{this.timelineController.cycleSecondary(),this.showControls(r.controlDisplayDuration)},onLayoutRequested:e=>{this.timelineController.playerLayoutMode(e),this.showControls(r.controlDisplayDuration)}}),$("#hoverButtonContainer").prepend("<div class='seek-bar-container'></div>"),this.timelineSeekBar=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineSeekBar)($(".seek-bar-container")[0],{timelineState:this.timelineState,broadcastEnded:this.delivery.broadcastEnded,disabled:!1,onPlayRequested:e=>{e?this.timelineController.pause():this.timelineController.resume()},onSeekRequested:e=>{this.requestSeek(e)},colors:s});const e=$("#hoverButtonContainer .playback-controls").empty();this.timelinePlaybackControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelinePlaybackControls)(e[0],{resources:Panopto.GlobalResources,timelineState:this.timelineState,useMobileLayout:this.isMobile,seekDisabled:!1,broadcastEnded:this.delivery.broadcastEnded,onPlayPauseButtonActivated:()=>this.togglePlayState(),onRewindButtonActivated:()=>{const e=this.timelineState.timelinePosition;this.requestSeek(Math.max(e-10,0))},onForwardButtonActivated:()=>{const e=this.timelineState.timelinePosition,t=this.timelineState.duration;this.requestSeek(Math.min(e+10,t))},onMuteUnmuteButtonActivated:()=>this.toggleMuted(),onVolumeChanged:(e,t)=>{"number"==typeof t&&(this.timelineController?.volume(t),0===t&&this.timelineController?.muted(!0)),e.preventDefault()},onGoLive:()=>{this.requestSeek(this.timelineState.duration)},onShowControlsRequested:()=>{},onResetHideControlsAfterUserActionRequest:()=>{},onResetHideControlsAfterBlurRequested:()=>{},colors:s});const t=$(".mobile-transport-controls").empty();this.timelineMobilePlaybackControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineMobilePlaybackControls)(t[0],{resources:Panopto.GlobalResources,timelineState:this.timelineState,seekDisabled:!1,onPlayPauseButtonActivated:()=>this.togglePlayState(),onRewindButtonActivated:()=>{const e=this.timelineState.timelinePosition;this.requestSeek(Math.max(e-10,0))},onForwardButtonActivated:()=>{const e=this.timelineState.timelinePosition,t=this.timelineState.duration;this.requestSeek(Math.min(e+10,t))}});const i=this.initParams.EnableCaptionsSettingsEnhancements||this.nonNativeCaptionsAvailable,o=this.nonNativeCaptionsAvailable,a=i?o?"visible":"disabled":"hidden",n=$("#secondaryControls").empty();this.timelineNavigationControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineNavigationControls)(n[0],{resources:Panopto.GlobalResources,presetPlaybackRates:r.playbackSpeeds,timelineState:this.timelineState,showDownloadButton:this.downloadEnabled,viewerButtonMode:this.showFullViewerLink?this.fullViewerLinkEnabled?"visible":"disabled":"hidden",viewerButtonTooltip:this.fullViewerLinkEnabled?Panopto.GlobalResources.Embed_Tooltip_FullViewer:Panopto.GlobalResources.Embed_Tooltip_FullViewerDisabled,captionButtonMode:a,showAudioDescriptionButton:!!this.initParams.AvailableAudioDescriptionLanguages.length,showFullscreenButton:(PanoptoCore.Helpers.fullscreenEnabled||Panopto.viewer.forceVideoPodcastOnMSE)&&this.fullscreenEnabled,isCurrentlyOnFullscreen:this.isFullscreen,vspDisabled:!1,isMobile:!!PanoptoCore.Browser.$_mobile,showCaptionSettingsButton:this.initParams.EnableCaptionsSettingsEnhancements,availableCaptionsLanguages:this.initParams.AvailableLanguages,availableAudioDescriptionsLanguages:this.initParams.AvailableAudioDescriptionLanguages,captionsLanguage:this.selectedCaption,captionsStyles:this.captionsStyles,audioDescriptionsLanguage:this.selectedAudioDescriptionLanguage,qualityCount:this.qualityCount,onCaptionsLanguageSelected:e=>{this.handleCaptionLanguageChangedAndToggleUI(e)},onAudioDescriptionsLanguageSelected:e=>{this.handleADLanguageChangedAndToggleUI(e)},onQualitySelected:e=>{this.timelineController&&this.timelineController.bitrate(e)},onDownloadButtonActivated:()=>{window.open(this.downloadUrl)},onViewerButtonActivated:this.handleFullViewerButtonActivated,onCaptionsActiveChanged:e=>{this.activateCaptionsToggle("toggle"===e?void 0:"active"===e)},onAudioDescriptionsActiveChanged:e=>{this.activateAudioDescriptionsToggle("toggle"===e?void 0:"active"===e)},onFullscreenRequested:()=>{this.toggleFullscreen()},onPlaybackRateRequested:e=>{this.requestSpeed(e)},onShowControlsRequested:()=>{},onResetHideControlsAfterBlurRequested:()=>{}}),PanoptoCore.Helpers.handleFullscreenEvent((()=>{this.timelineNavigationControls?.setProps({isCurrentlyOnFullscreen:this.isFullscreen})})),$("#embed").toggleClass("mobile",this.isMobile),this.player.toggleClass("mobile",this.isMobile),$(".touch-overlay").toggle(this.isMobile),$("#loadingSpinner").remove(),this.vspSupported||$(".bottom-transport-controls, .mobile-transport-controls, .seek-bar-container, .fp-duration").hide(),$("#overlay").css({"z-index":11})}embedControlSetupFlowplayer(){this.embedApiParser=new PanoptoViewer.EmbedApi.PostMessageHandler(this.handleEmbedApiCommand,this.remoteHost,this.embedApiId),this.flowplayer.splash&&this.embedApiParser.sendPostMessage("embedIframeReady"),this.flowplayer.on("pause resume stop playing finish seek volume progress speed error",(e=>{switch(e.type){case"pause":case"resume":case"stop":case"playing":case"finish":this.sendApiStateUpdate("iframeStateUpdate");break;case"speed":this.sendApiStateUpdate("iframeSpeedUpdate");break;case"error":this.embedApiParser.sendPostMessage("iframeError","mediaPlayerError");break;default:this.sendApiStateUpdate(void 0)}}))}sendReactNativeStateUpdate(){let e=null;this.flowplayer?e={name:this.delivery.title,folderName:this.delivery.folder.name,thumbUrl:`${Panopto.uriScheme}://${Panopto.webServerFQDN}${this.initParams.ThumbUrl}`.replace("usePng=False","usePng=True"),streamUrl:this.flowplayer.video.src,isPlaying:this.flowplayer.playing,position:this.flowplayer.video.time,playbackRate:this.flowplayer.currentSpeed,isMuted:this.flowplayer.muted}:this.timelineController&&(e={name:this.delivery.title,folderName:this.delivery.folder.name,thumbUrl:`${Panopto.uriScheme}://${Panopto.webServerFQDN}${this.initParams.ThumbUrl}`.replace("usePng=False","usePng=True"),streamUrl:this.timelineState.activePrimary?.streamUrl,isPlaying:!this.timelineState.paused,position:this.timelineState.timelinePosition,playbackRate:this.timelineState.playbackRate,isMuted:this.timelineState.muted}),e&&this.isReactNativeApp&&this.sendReactNativeMessage({action:"state",state:e})}sendApiStateUpdate(e){if(!this.embedApiParser)return;let t;this.flowplayer?t={trigger:e,volume:this.flowplayer.volumeLevel,isMuted:0===this.flowplayer.volumeLevel,currentTime:this.flowplayer.video.time,speed:this.flowplayer.currentSpeed,duration:this.flowplayer.video.duration,isPaused:this.flowplayer.paused,isFinished:this.flowplayer.finished,captionLanguages:this.availableLanguagesFriendly,selectedLanguage:this.initParams.AvailableLanguages.indexOf(this.selectedCaption),areCaptionsEnabled:this.captionsDisplayed,qualityCount:0}:this.timelineController&&(t={trigger:e,volume:this.timelineState.volume,isMuted:this.timelineState.muted,currentTime:this.timelineState.timelinePosition,speed:this.timelineState.playbackRate,duration:this.timelineState.duration,isPaused:this.timelineState.paused,isFinished:this.timelineState.isEnded,captionLanguages:this.availableLanguagesFriendly,selectedLanguage:this.initParams.AvailableLanguages.indexOf(this.selectedCaption),areCaptionsEnabled:this.captionsDisplayed,qualityCount:this.qualityCount}),this.embedApiParser.sendPostMessage("iframeState",t)}sendReactNativeMessage(e){const t="back"===e.action?e.action:JSON.stringify(e);window.ReactNativeWebView?.postMessage(t),console.log(t)}async ensurePlayAllowed({muted:e}){const t=await this.checkAndReportAutoplay({muted:e});return t.canAutoplay||!t.canAutoplayMuted||this.flowplayer||this.mute(!0),t.canAutoplayMuted}async prepareForUnmute(){if(!(this.flowplayer?this.flowplayer.paused:this.timelineState?.paused??!1)){(await this.checkAndReportAutoplay({muted:!1})).canAutoplay||this.pause()}}async checkAndReportAutoplay({muted:e}){const t=await PanoptoViewer.canAutoplay({muted:e,playsInline:!0});return e||t.canAutoplay||!t.canAutoplayMuted?t.canAutoplayMuted||this.embedApiParser.sendPostMessage("iframeError","playNotAllowed"):this.embedApiParser.sendPostMessage("iframeError","playWithSoundNotAllowed"),t}render(){this.wasRenderCalled=!0,$("#title").toggle(this.showTitle),$("#player").toggleClass("title-shown",this.showTitle),$("#embed").toggleClass("show-interactivity","none"!==this.interactivity),this.player.toggleClass("audio-only",this.initParams.IsAudioOnly);let t=PanoptoCore.Helpers.StringHelpers.getUserKeyComponents(Panopto.user.userKey).provider;t&&Panopto.GoogleAnalytics.sendEvent({source:"viewer-embed",action:"embedded-view",label:t}),this.configureGlobalControls(),this.configureSplashScreen();const i=PanoptoViewer.canAutoplay({muted:this.startMuted,playsInline:!0,autoPlayRequested:this.autoPlayRequested});if(this.playlistId&&i.then((e=>{this.configurePlaylistOverlay(e.canAutoplay||e.canAutoplayMuted)})),this.initParams.ErrorCode)this.handleError();else if(this.delivery)if(this.isLiveBroadcast&&!this.delivery.activePrimary)this.showCallToAction({message:Panopto.GlobalResources.Embed_BroadcastNotStarted});else if(this.enableMultistream&&this.delivery.isEmbedViewable){if(Panopto.user.userId||(this.delivery.documents=this.delivery.documents.filter((e=>!e.isQuiz))),Panopto.user.userId){const t=new PanoptoQuiz.QuizResultsController(this.quizzes,(()=>{this.timelineController.dismissDocumentPlayer()}),(()=>{this.timelineController.dismissDocumentPlayer()}),this.ltiOutcomeConfig,this.ltiAgsConfig);e.Viewer.QuizResultsController.setInstance(t)}this.timelineController=new PanoptoViewer.Controllers.TimelineController(this.delivery,Panopto.appRoot,e.Viewer.QuizResultsController.getInstance(),Panopto.GlobalResources,Panopto.captionSettings.size,(e=>this.handleTimelineControllerStateChanged(e)),{resetToStartUponVoDEnd:!(this.remoteEmbed&&Panopto.enableEmbedApi||this.scormEnabled),defaultLayout:this.defaultLayout,focusService:Panopto.Core.UI.Accessibility,notifyInitialState:e=>{this.timelineState=e,$("#title").toggleClass("has-layout-controls",this.timelineState?.availableSecondaryCount>0)}}),this.initParams.AvailableLanguages.length>0&&this.getCaptions(this.deliveryId,this.inviteId,this.selectedCaption).then((()=>{$("#captionsButton").show(),this.toggleCaptions(this.captionsDisplayed)})),this.initParams.AvailableAudioDescriptionLanguages.length&&this.getAudioDescriptions(this.deliveryId,this.inviteId,this.selectedAudioDescriptionLanguage).done((()=>{$("#audioDescriptionsButton").show(),this.toggleAudioDescriptions(this.audioDescriptionsActivated)})),this.configureTimelineControllerControls(),this.configurePanoptoControls(),this.generateCaptionStylesheet(),"none"!==this.interactivity&&this.configureEventsControl(),$("#broadcastStatusWrapper").insertAfter($("#audioOnlyIcon")),this.hideOverlay&&$("#hoverButtonContainer").css("visibility","hidden"),i.then((e=>{const t=e.canAutoplay||e.canAutoplayMuted;!e.canAutoplay&&e.canAutoplayMuted&&this.mute(!0),t&&this.playlistId&&this.playlistOverlay.visible()||this.showCopyrightNoticeIfRequired(),t&&!this.playlistId?this.loadVideo():($("#playIconContainer").toggle(!this.isMobile),$("#splashPlayIconContainer").toggle(this.isMobile))})),this.remoteEmbed&&Panopto.enableEmbedApi&&(this.embedApiParser=new PanoptoViewer.EmbedApi.PostMessageHandler(this.handleEmbedApiCommand,this.remoteHost,this.embedApiId),this.embedApiParser.sendPostMessage("embedIframeReady"))}else{if("none"!==this.interactivity&&this.configureEventsControl(),this.initializePlayer(),this.fullscreenEnabled&&this.configureFullscreenControls(),this.remoteEmbed&&Panopto.enableEmbedApi&&this.embedControlSetupFlowplayer(),this.isReactNativeApp&&this.flowplayer.on("pause resume stop playing finish seek progress speed volume",(()=>{this.sendReactNativeStateUpdate()})),"undefined"!=typeof playerjs){Panopto.PlayerJsFlowplayerAdapter(this.flowplayer,{loadCallback:()=>{this.loadVideo()}}).ready()}this.flowplayer.one("ready",(()=>{if(this.videoElement=this.player.find("video.fp-engine")[0],this.hideOverlay?$(".fp-ui").hide():(this.configureFlowplayerControls(),this.configurePanoptoControls(),this.configureKeyHandler()),this.quizzes.length&&Panopto.user.userId&&(this.configureProgressListener(),Panopto.user.userId&&this.configureQuizResultsController()),this.videoElement&&(this.videoElement.textTracks.length&&(this.isLiveBroadcast&&!this.nonNativeCaptionsAvailable?($("#captionsButton").toggle(!0),this.updateDividerVisibility(),this.captionsDisplayed=this.shouldDisplayCaptionsInitially,this.toggleNativeCaptions(!0)):this.toggleNativeCaptions(!1)),this.videoElement.textTracks.onaddtrack=e=>{this.isLiveBroadcast&&!this.nonNativeCaptionsAvailable?($("#captionsButton").toggle(!0),this.updateDividerVisibility(),this.toggleNativeCaptions(!0)):e.track.mode="disabled"},this.isLiveBroadcast)){let e=!1;this.flowplayer.on("pause",(()=>e=!0)),this.flowplayer.on("pause",(()=>{this.checkWebcastEnded(!0,this.isFlowPlayerAtTheEnd())}));let t=!1;this.flowplayer.on("finish",(()=>t=!0)),document.addEventListener("visibilitychange",(()=>{document.hidden||!e||t||(this.flowplayer.load(this.flowplayer.conf.clip),e=!1)}))}this.flowplayer.on("durationchange",(()=>{this.timelineSeekHelper.updateDuration(this.flowplayer.video.duration)})),this.toggleCaptions(this.captionsDisplayed),this.startTime&&!this.flowplayer.engine.hls&&this.flowplayer.one("progress",(()=>{this.seek(this.startTime)}))})),i.then((e=>{const t=e.canAutoplay||e.canAutoplayMuted;t&&this.playlistId&&this.playlistOverlay.visible()||this.showCopyrightNoticeIfRequired(),t&&!this.playlistId?this.loadVideo():($("#playIconContainer").toggle(!this.isMobile),$("#splashPlayIconContainer").toggle(this.isMobile))})),this.eventOverlay&&this.flowplayer.on("progress",((e,t,i)=>{this.positionListeners.forEach((e=>e(i)))})),this.playlistId?this.flowplayer.on("finish",(()=>this.playlistOverlay.queueNextItem())):this.delivery.nextDelivery&&this.flowplayer.on("finish",(()=>this.showNextDelivery())),this.flowplayer.on("progress",((e,t,i)=>{this.timelineSeekHelper.updateFurthestWatchedPoint(i);const o=this.timelineSeekHelper.getValidPlaySpeed(this.flowplayer.currentSpeed,i);o!==this.flowplayer.currentSpeed&&this.setSpeed(o||PanoptoViewer.PlaySpeed.Normal)}))}else this.initParams.ErrorCode=PanoptoViewer.Data.ErrorCode.InvalidDelivery,this.handleError()}handleKeyDown(e){e.which===o.Esc&&this.isLandscape&&this.eventOverlayShown&&(this.toggleEventOverlay(!1,{keyboardInitiated:!0}),this.showControls(r.controlDisplayDuration),$("#eventOverlay").one("transitionend",(()=>{$("#eventOverlayGutter .hit-target").focus()})))}configureEventsControl(){const e=$("#eventOverlayGutter .hit-target");Panopto.Core.UI.Handlers.button(e,((e,t)=>{this.toggleEventOverlay(!this.eventOverlayShown,{keyboardInitiated:"mousedown"!==t.type}),this.eventOverlayShown&&this.hideMenus(),this.showControls(!this.eventOverlayShown&&r.controlDisplayDuration,{ignorePlayState:!0})}),{pointerEvent:"mousedown touchstart"}),Panopto.Core.UI.Handlers.key(e,((e,t)=>{this.handleKeyDown(t)}),[o.Esc],{preserveExisting:!0});const t={delivery:this.delivery,sessionId:this.sessionId,userId:Panopto.user.userId,inviteId:this.inviteId,loginUrl:Panopto.loginUrl,isLandscape:this.isLandscape,isMobile:this.isMobile,isMobileApp:this.isApp,isBroadcast:this.isLiveBroadcast,interactivity:this.interactivity,isDiscussionDownloadEnabled:!(this.isApp&&this.isIos),areSocialFeaturesEnabled:Panopto.features.areSocialFeaturesEnabled,areRatingsEnabled:Panopto.features.areRatingsEnabled,areNotesEnabled:Panopto.features.notesEnabled,areCaptionsSettingsEnhancementsEnabled:this.initParams.EnableCaptionsSettingsEnhancements,resources:Panopto.GlobalResources,initialSearchTerm:this.initialSearchTerm,availableLanguages:this.timelineController?this.initParams.AvailableLanguages:this.initParams.AvailableLanguages.slice(0,3),selectedLanguage:this.selectedCaption,availableAudioDescriptionLanguages:this.initParams.AvailableAudioDescriptionLanguages,selectedAudioDescriptionLanguage:this.selectedAudioDescriptionLanguage,showAllTocEntries:this.enableMultistream,onAddPositionListener:e=>{this.positionListeners.push(e),e(this.getPosition())},onRemovePositionListener:e=>{this.positionListeners=this.positionListeners.filter((t=>t!==e))},onLanguageChanged:e=>this.handleCaptionLanguageChanged(e),onAudioDescriptionLanguageChanged:e=>this.handleADLanguageChanged(e),onSeekRequested:e=>{const t=this.timelineSeekHelper.getValidPosition(e);void 0!==t&&(this.toggleEventOverlay(!1),this.showControls(r.playDisplayDuration),this.flowplayer?this.flowplayer.splash?(this.startTime=t,this.flowplayer.conf.hlsjs.startPosition=t,this.loadVideo()):this.requestSeek(t,(()=>this.flowplayer.resume())):this.timelineController&&(this.player.hasClass("is-ready")?(this.requestSeek(t),this.timelineController.resume()):(this.startTime=t,this.loadVideo())))},onKeyDown:e=>this.handleKeyDown(e),showSendLogs:!!this.invocationId,onSubmitLogs:()=>this.submitClientLog()};this.eventOverlay=Panopto.EmbedEventOverlay(document.getElementById("eventTabControl"),t)}toggleEventOverlay(e,{keyboardInitiated:t=!1}={}){"none"!==this.interactivity&&(this.eventOverlayShown=void 0!==e?e:!this.eventOverlayShown,$("#embed").toggleClass("event-overlay-shown",this.eventOverlayShown),this.eventOverlayShown?$("#eventOverlayGutter .hit-target").attr("aria-expanded","true"):$("#eventOverlayGutter .hit-target").removeAttr("aria-expanded"),this.timelineController&&(this.eventOverlayShown?this.timelineController.captionVisible(!1):this.timelineController.captionVisible(this.captionsDisplayed)),this.isLandscape&&this.handleEventOverlayModeChanged({isOverlay:this.eventOverlayShown,keyboardInitiated:t}))}handleEventOverlayModeChanged({isOverlay:e,keyboardInitiated:t=!1}){e?Panopto.Core.UI.Accessibility.trapFocus(this.eventOverlayElement):Panopto.Core.UI.Accessibility.releaseFocus(this.eventOverlayElement),e&&$("#eventOverlay").one("transitionend",(()=>{if(t)$("#eventOverlayGutter .hit-target").focus();else{const e=$("#eventOverlay").find(":tabbable").first();e.focus(),e.addClass("clicked"),e.one("blur",(()=>e.removeClass("clicked")))}}))}initializePlayer(){let e={sources:[{type:this.initParams.MediaFileType===PanoptoViewer.Services.Panopto_Shared_MediaFileType.hls?r.hlsMimeType:r.mp4MimeType,src:this.videoUrl}],live:this.isLiveBroadcast,vr:this.isVR};if(this.nonNativeCaptionsAvailable){const t=this.initParams.CaptionUrl.map((e=>({kind:"subtitles",label:Panopto.GlobalResources.ModalPopup_SessionTranscriptDisplayName,src:e})));e.subtitles=t,this.generateCaptionStylesheet()}const t=-1!==window.location.search.indexOf("debuglog=true");let i={startLevel:-1,safari:!0,debug:new PanoptoViewer.HlsjsDebugLogger(this.initParams.DeliveryId)};this.startTime&&(i.startPosition=this.startTime);let o={};try{o=JSON.parse(Panopto.viewer.hlsJsConfig)}catch(e){a.warning(n.formatMessageWithContext("initializePlayer","Error parsing HlsJsConfig setting, ignored."),Panopto.viewer.hlsJsConfig)}_.extend(i,o),this.flowplayer=flowplayer(this.player,{key:this.initParams.PlayerKey,clip:e,splash:!0,ratio:!1,fullscreen:!1,native_fullscreen:!0,keyboard:!1,embed:!1,tooltip:!1,speeds:r.playbackSpeeds,hlsjs:i,chromecast:!Panopto.features.disableFeaturesRequiringExternalNetworkAccess,vrvideo:{touchcontrols:!1,polyfill:!0,mode:this.initParams.VRType===PanoptoViewer.MediaVRType.Full?"full":this.initParams.VRType===PanoptoViewer.MediaVRType.Half?"half":void 0,renderOnPause:!0},debug:t}),this.flowplayer.conf.nativesubtitles=!1,this.player.toggleClass("mobile",this.isMobile),$("#player").find(".fp-elapsed, .fp-duration, .fp-remaining").appendTo("#hoverButtonContainer .flowplayer-time-display"),$("#overlay").prependTo(".fp-ui"),$("#hoverButtonContainer").appendTo(".fp-ui"),$("#playbackSpeedMenu").appendTo(".fp-player"),this.player.find(".fp-timeline-tooltip").appendTo(".fp-player"),$("#playlistOverlay").appendTo(".fp-player"),$(".fp-waiting").empty().append($("#loadingSpinner")).insertAfter(".fp-ui")}generateCaptionStylesheet(){let e=document.head.appendChild(document.createElement("style"));const t=PanoptoViewer.calculateCaptionFontSize(Panopto.captionSettings.size);let i=Panopto.captionSettings.backgroundColor;"transparent"!==i&&(i=new PanoptoCore.Color(i).setAlpha(Panopto.captionSettings.opacity).toRgba()),e.sheet.insertRule("#captionPlayer .caption-player-container > p,#player .fp-subtitle > *,#player .fp-captions > * {color: "+Panopto.captionSettings.color+";background: "+i+";text-shadow: "+Panopto.captionSettings.textShadow+";font-size: "+t+"px;}",0)}configureGlobalControls(){Panopto.Core.UI.Handlers.button($("#appBackButton, #absoluteBackButton"),(()=>{this.isIosApp?window.location.href="panopto://close-player":this.isReactNativeApp&&this.sendReactNativeMessage({action:"back"})})),$("#appBackButton").css("padding-top",this.isIos?"8px":"7px").toggle(this.hasBackButton),$("#embed").toggleClass("has-back-button",this.hasBackButton),Panopto.Core.UI.Handlers.button($("#playIconContainer"),(()=>this.loadVideo())),Panopto.Core.UI.Handlers.button($("#fullViewerButton"),this.handleFullViewerButtonActivated),$("#fullViewerButton").toggle(!!this.showFullViewerLink&&!!this.initParams.ViewerLink),this.fullViewerLinkEnabled||$("#fullViewerButton").addClass("disabled").attr("title",Panopto.GlobalResources.Embed_Tooltip_FullViewerDisabled),Panopto.Core.UI.Handlers.button($("#downloadButton"),(()=>{window.open(this.downloadUrl)})),this.downloadEnabled&&$("#downloadButton").removeAttr("style")}configureSplashScreen(){if(this.enableMultistream&&this.player.toggleClass("is-splash",!0),!this.initParams.IsAudioOnly){let e=this.initParams.ThumbUrl,t=e=>$("#splashScreen").css("background-image",`url(${e})`);t(e),$(new Image).on("error",(()=>t(this.defaultThumbnailUrl))).prop("src",e)}if(Panopto.Core.UI.Handlers.button($("#splashPlayIconContainer"),(()=>this.loadVideo()),{pointerEvent:"mousedown touchend"}),$("#splashScreen").click((e=>{this.menuOpen?(this.playlistOverlay&&this.playlistOverlay.hide(),e.preventDefault(),e.stopPropagation()):this.loadVideo()})),this.showBrand){let e=this.initParams.LogoUrl;e&&-1!==e.indexOf("_branding")&&($("#logo").attr({src:e,alt:Panopto.GlobalResources.Admin_Branding_EmbedLogo_Label}),Panopto.viewer.viewerWatermarkPosition&&(this.watermark=new PanoptoViewer.WatermarkLogo(e,Panopto.viewer.viewerWatermarkPosition),$("#embed").append(this.watermark.getBrandElem())))}this.isReactNativeApp||($("#cobrand").toggleClass("no-link",!Panopto.features.linkPoweredByPanoptoInEmbed).show(),$("#cobrand a").click((e=>e.stopPropagation())))}configureFullscreenControls(){Panopto.Core.UI.Handlers.button($("#fullScreenButton"),(()=>{this.toggleFullscreen()})),PanoptoCore.Helpers.fullscreenEnabled?($("#fullScreenButton").show(),$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",(()=>{const e=this.isFullscreen;$("#fullScreenIcon").toggle(!e),$("#fullScreenExitIcon").toggle(e)}))):PanoptoCore.Browser.$_iphone&&(this.flowplayer.on("fullscreen",(()=>this.handleNativeFullscreenToggled(!0))),this.flowplayer.on("fullscreen-exit",(()=>this.handleNativeFullscreenToggled(!1))))}get isFullscreen(){return Boolean(PanoptoCore.Helpers.getFullscreenElement())}toggleFullscreen(e){if(this.fullscreenEnabled&&e!==this.isFullscreen)if(e=void 0===e?!this.isFullscreen:e,PanoptoCore.Helpers.fullscreenEnabled)PanoptoCore.Helpers.toggleFullscreen(document.body,e);else if(PanoptoCore.Browser.$_iphone)if(this.timelineController&&Panopto.viewer.forceVideoPodcastOnMSE){const t=document.getElementsByTagName("video")[0];void 0!==t&&(e?t.webkitEnterFullScreen():t.webkitExitFullScreen())}else this.iPhoneReturnFromFullscreenPlaying=!this.videoElement.paused,this.flowplayer.fullscreen()}handleNativeFullscreenToggled(e){if(this.nativeFullscreen=e,this.player.find("video").toggleClass("native-fullscreen",e),e)this.captionsDisplayed&&this.videoElement.textTracks.length&&this.toggleNativeCaptions(!0);else{let e=!1;_.each(this.videoElement.textTracks,(t=>{"showing"===t.mode&&(e=!0),t.mode="disabled"})),this.toggleCaptions(e),this.iPhoneReturnFromFullscreenPlaying&&setTimeout((()=>this.videoElement.play()),0)}}updateBroadcast(e){if(this.delivery=e,this.timelineController)this.timelineController.updateDelivery(e),this.timelineSeekBar?.setProps({broadcastEnded:e.broadcastEnded}),this.timelinePlaybackControls?.setProps({broadcastEnded:e.broadcastEnded});else if(this.flowplayer&&!e.broadcastEnded&&e.activePrimary){let t=this.ensureMobileCompatibleManifest(e.activePrimary.url);if(t!==this.videoUrl){this.videoUrl=t;let e=this.flowplayer.conf.clip;_.each(e.sources,(e=>{e.src=t})),this.flowplayer.load(e,(()=>{this.loggerSeekHandler&&this.loggerSeekHandler()}))}}}checkForBlockingLTIQuiz(){const e=$("#ltiQuizBlock");Panopto.LTIQuizBlock(e[0],{deliveryId:this.delivery.id,sessionHasQuiz:this.quizzes.length>0,ltiBlockSetting:PanoptoViewer.LTIQuizBlockingMode[Panopto.viewer.blockLTISessionsWithQuiz],ltiQueryParam:this.isLTIContext,checkBlockSessionOnQuizReporting:Panopto.Core.ServiceInterface.Rest.Sessions.blockSessionOnQuizReporting,onPopupResolved:()=>{e.hide(),this.checkBlockingLTIQuiz.resolve()},resources:Panopto.GlobalResources})}loadVideo(){this.playlistId&&!this.playlistOverlay.visible()&&this.showCopyrightNoticeIfRequired(),this.enableMultistream&&this.player.toggleClass("is-splash",!1),this.checkCopyrightNoticeRequirement.done((()=>{if(this.invocationRequested)return;this.invocationRequested=!0;let e=0;PanoptoCore.withRetry(((t,i,o)=>{this.createInvocation((a=>{a?i(a):3==++e?o():t()}))})).then((e=>{this.invocationId=e,this.deliveryRefreshTimer.setInvocationId(this.invocationId),this.flowplayer&&this.delivery.activePrimary?this.attachPlaybackLoggerToFlowplayer():this.timelineController&&(this.timelineController.updateInvocationContext(Panopto.user.userId,e,this.deliveryId),this.delivery.isEmbedViewable&&this.attachPlaybackLoggerToTimelineController()),this.eventOverlay?.setProps({showSendLogs:!0})})).catch((()=>{this.pause(),PanoptoReactComponents.Dialogs.PanoptoConfirmController.confirm({message:Panopto.GlobalResources.Viewer_Dialogs_SpanUpdateBlocked_Message,confirmMessage:Panopto.GlobalResources.Viewer_Dialogs_SpanUpdateBlocked_AcceptMessage,cancelMessage:Panopto.GlobalResources.Viewer_Dialogs_SpanUpdateBlocked_CancelMessage,onClose:e=>{e&&window.open(Panopto.viewer.analyticsIngestBlockedSupportPageUrl,"_blank")}})})),this.checkBlockingLTIQuiz.then((()=>{if(this.timelineController){let e=0;e=this.isLiveBroadcast?1/0:this.startTime,this.timelineController.start(e),this.remoteEmbed&&Panopto.enableEmbedApi&&this.sendApiStateUpdate("iframeStateUpdate"),this.player.addClass("is-ready"),$().add("#player").add("#eventOverlayGutter").on("mousemove",(()=>{this.showControls(r.controlDisplayDuration)})).on("focusin",(()=>{this.showControls(r.controlDisplayDuration)})).on("mouseleave",(()=>{if(this.autoHideEnabled){let e=!this.autoHideRequested;this.showControls(!1,{slowFade:!0,ignorePlayState:e})}})),$("#overlay").addClass("fp-ui"),$("#hoverButtonContainer").addClass("fp-ui"),this.hideOverlay&&($(".touch-overlay").css("visibility","hidden"),$("#overlay").css("visibility","hidden"))}this.flowplayer&&this.flowplayer.load(),$("#splashScreen").hide(),$("#gradientTop, #gradientBottom").insertAfter($("#splashScreen")),PanoptoCore.Browser.$_iphone&&!this.enableMultistream&&$("#fullScreenButton").toggle(this.fullscreenEnabled),$("#playIconContainer").off("click keydown").attr("tabindex",null).fadeOut(500),this.showControls(r.playDisplayDuration)}))}))}createInvocation(e){let t=Panopto.Core.InvocationType.None;t=this.isIosApp?this.isLiveBroadcast?Panopto.Core.InvocationType.MobileApplicationBroadcast:Panopto.Core.InvocationType.MobileApplication:this.isAndroidApp?this.isLiveBroadcast?Panopto.Core.InvocationType.AndroidApplicationBroadcast:Panopto.Core.InvocationType.AndroidApplication:this.isReactNativeApp?this.isLiveBroadcast?Panopto.Core.InvocationType.ReactNativeMobileBroadcast:Panopto.Core.InvocationType.ReactNativeMobile:this.isVideoPreview?this.isLiveBroadcast?Panopto.Core.InvocationType.VideoPreviewBroadcast:Panopto.Core.InvocationType.VideoPreview:this.isLiveBroadcast?Panopto.Core.InvocationType.EmbedBroadcast:Panopto.Core.InvocationType.EmbedViewer;let i={deliveryId:this.deliveryId,inviteId:this.inviteId,invocationType:t},o=!1;this.ltiCourseId&&(o=!0,i.invocationContextType=Panopto.Core.InvocationContextType.LTILaunch,i.invocationContextLiteral=this.ltiCourseId);const a={methodName:"CreateInvocation"+(o?"WithContext":""),data:i,loadingIndicator:null};PanoptoApiClient.doFetchWcfApi(a).then(e).catch((t=>{403===t._statusCode?location.replace(this.loginUrl):e()}))}attachPlaybackLoggerToTimelineController(){Panopto.Core.Analytics.PlaybackLogger(this.timelineController.createPlayerInterfaceForPlaybackLogger(),this.invocationId,Panopto.Core.ServiceInterface.AnalyticsIngest.addStreamRequests,{onSpanUpdateBlocked:()=>PanoptoViewer.handleSpanUpdateBlocked(Panopto.GlobalResources,this.viewerLogging,Panopto.viewer.enableAutomaticLogsUpload,Panopto.viewer.analyticsIngestBlockedSupportPageUrl,this.deliveryId,this.invocationId,(()=>{this.timelineController?.pause()}))}).start()}isFlowPlayerAtTheEnd(){return this.isPositionAtTheEnd(this.flowplayer.video.time,this.flowplayer.video.duration)}isPositionAtTheEnd(t,i){return t>=i-e.Viewer.Constants.EndPositionThreshold}attachPlaybackLoggerToFlowplayer(){let t={position:()=>{const t=e.Viewer.Constants.NativePositionFallbackRegion;let i=this.flowplayer.video.time||0;return i>t&&this.videoElement&&this.videoElement.currentTime<t&&(i=this.videoElement.currentTime),i},playSpeed:()=>this.flowplayer.currentSpeed,streamId:()=>this.delivery.activePrimary.id,onSeek:e=>{this.loggerSeekHandler=e},offSeek:()=>{this.loggerSeekHandler=void 0},onSpeedChange:e=>{this.loggerSpeedChangeHandler=e},offSpeedChange:()=>{this.loggerSpeedChangeHandler=void 0},onPlayStateChangeLog:e=>{this.loggerPlayStateChangeHandler=e},offPlayStateChangeLog:()=>{this.loggerPlayStateChangeHandler=void 0}},i=Panopto.Core.Analytics.PlaybackLogger(t,this.invocationId,Panopto.Core.ServiceInterface.AnalyticsIngest.addStreamRequests),o=()=>{i.start(),this.isLiveBroadcast&&this.flowplayer.one("progress",(()=>{this.loggerSeekHandler&&this.loggerSeekHandler()}))};this.flowplayer.on("seek",(()=>{this.loggerSeekHandler&&this.loggerSeekHandler()})),this.flowplayer.on("pause",(()=>{let e=this.isFlowPlayerAtTheEnd()?Panopto.Core.ViewerPlayState.Stopped:Panopto.Core.ViewerPlayState.Paused;this.loggerPlayStateChangeHandler&&this.loggerPlayStateChangeHandler(Panopto.Core.ViewerPlayState.Playing,e)})),this.flowplayer.on("resume",(()=>{this.flowplayer.video.time<this.flowplayer.video.duration&&this.loggerPlayStateChangeHandler&&this.loggerPlayStateChangeHandler(Panopto.Core.ViewerPlayState.Paused,Panopto.Core.ViewerPlayState.Playing)})),this.flowplayer.on("stop",(()=>{this.loggerPlayStateChangeHandler&&this.loggerPlayStateChangeHandler(void 0,Panopto.Core.ViewerPlayState.Stopped)})),this.flowplayer.ready?o():this.flowplayer.one("ready",(()=>o()))}configureFlowplayerControls(){let e,t,i=this.player.find(".fp-timeline"),o=this.player.find(".fp-timeline-tooltip");this.player.add($("#embed #eventOverlayGutter")).on("mousemove",(i=>{void 0===e||i.pageX===e&&i.pageY===t||this.eventOverlayShown&&this.isLandscape||this.showControls(r.controlDisplayDuration),e=i.pageX,t=i.pageY})).on("focusin",(()=>this.showControls(r.controlDisplayDuration))).on("mouseleave",(()=>{if(this.autoHideEnabled){let e=!this.autoHideRequested;this.showControls(!1,{slowFade:!0,ignorePlayState:e})}})),this.flowplayer.on("resume",(()=>this.showControls(r.playDisplayDuration))),this.player.find(".fp-player").on("touchmove touchend",(()=>this.showControls(r.controlDisplayDuration))),this.isMobile||i.hover((()=>{this.menuOpen||o.show()}),(()=>{o.hide()})),i.attr({tabindex:1,role:"slider","aria-valuemin":0,"aria-valuemax":Math.round(this.flowplayer.video.duration),"aria-valuenow":Math.round(this.flowplayer.video.time),"aria-label":Panopto.GlobalResources.Embed_Timeline}),this.flowplayer.on("progress",(()=>{i.attr("aria-valuenow",Math.round(this.flowplayer.video.time))})),this.isVR&&this.configureVRControls()}configureVRControls(){let e,t;this.player.find(".fp-ui").mousedown((i=>{e=i.pageX,t=i.pageY})).click((i=>{!(i.which===Panopto.Core.MouseButton.Left&&e===i.pageX&&t===i.pageY)||this.isLiveBroadcast||this.isMobile||this.togglePlayState()})),this.player.find(".fp-timeline").click((e=>e.stopPropagation()))}updateDividerVisibility(){(this.downloadEnabled||this.showFullViewerLink)&&(this.nonNativeCaptionsAvailable||this.vspSupported&&"no-seeking"!==this.seekAndVspBehavior||this.fullscreenEnabled)&&$("#divider").show()}configurePanoptoControls(){this.player.find(".touch-overlay").on("touchend",(e=>{this.showControls(r.controlDisplayDuration),e.preventDefault(),e.stopPropagation()})),$("#overlay, #title, #gradientTop, #gradientBottom").on("click",(e=>{const t=e.target!==e.currentTarget;t||this.menuOpen||this.isLiveBroadcast&&this.flowplayer||this.isMobile||this.togglePlayState(),!t&&this.isMobile&&this.showControls(!1,{ignorePlayState:!0}),this.flowplayer&&e.stopPropagation()})).dblclick((e=>{e.target!==e.currentTarget||this.isMobile||this.toggleFullscreen()}));let e=this.player.find(".mobile-transport-controls .play, .bottom-transport-controls .play");Panopto.Core.UI.Handlers.button(e,(()=>this.togglePlayState()),{pointerEvent:"mousedown touchstart"});let t=()=>{let t=Panopto.GlobalResources[this.player.is(".is-playing")?"Embed_Tooltip_Pause":"Embed_Tooltip_Play"];e.attr({title:t,"aria-label":t})};this.flowplayer&&this.flowplayer.on("pause resume stop",(()=>t())),this.flowplayer&&t(),Panopto.Core.UI.Handlers.button($("#player .mobile-transport-controls .skip-back").add($("#player .bottom-transport-controls .skip-back")),((e,t)=>{const i=this.timelineController?this.timelineState.timelinePosition:this.flowplayer.video.time;this.requestSeek(Math.max(i-10,0)),t.stopPropagation()}),{pointerEvent:"mousedown touchstart"}),Panopto.Core.UI.Handlers.button($("#player .mobile-transport-controls .skip-forward").add($("#player .bottom-transport-controls .skip-forward")),((e,t)=>{const i=this.getPosition(),o=this.getDuration();this.requestSeek(Math.min(i+10,o)),t.stopPropagation()}),{pointerEvent:"mousedown touchstart"}),this.configureVolumeControls(),Panopto.Core.UI.Handlers.button($("#captionsButton"),(()=>{this.activateCaptionsToggle()})),$("#captionsButton").toggle(this.nonNativeCaptionsAvailable),Panopto.Core.UI.Handlers.button($("#audioDescriptionsButton"),(()=>{this.activateAudioDescriptionsToggle()})),$("#audioDescriptionsButton").toggle(!!this.initParams.AvailableAudioDescriptionLanguages.length),this.updateDividerVisibility(),_.each(r.menus,(e=>{Panopto.Core.UI.Handlers.button($(e.buttonSelector),((t,i)=>{this.toggleMenu(e);let o=$(e.menuSelector).find("."+r.selectedClass);$(t).is(".on")&&o.length&&(this.focusMenuItem(o),o.toggleClass(r.clickedClass,"click"===i.type))}))})),document.addEventListener("click",(e=>{const t=e.composedPath();_.each(r.menus,(e=>{-1===t.indexOf($(e.menuSelector)[0])&&-1===t.indexOf($(e.buttonSelector)[0])&&this.toggleMenu(e,!1)}))}),{capture:!0}),this.player.click((e=>{this.playlistOverlay&&!$(e.target).closest("#playlistOverlay").length&&this.playlistOverlay.hide(),$(e.target).closest(".layout-container").length||$(e.target).closest("#playbackControls").length||$(e.target).closest("#mobilePlaybackControls").length||$(e.target).closest("#navigationControls").length||(e.preventDefault(),e.stopPropagation())})),"no-seeking"===this.seekAndVspBehavior?this.disableSeekAndVspControls():this.enableSeekAndVspControls(),this.configurePlaybackSpeedControls()}configureVolumeControls(){this.configureMuteButton(),this.isMobile?r.flowplayerGlobal.support.volume&&this.toggleMuted(this.startMuted):this.configureVolumeSlider(),this.flowplayer&&this.flowplayer.on("volume",(()=>{let e=100*this.flowplayer.volumeLevel;this.setVolumeCookie(e)}))}setVolumeCookie(e){this.startTourMutedQuery||PanoptoCore.setUserSetting("defaultEmbedVolume",e)}configureMuteButton(){Panopto.Core.UI.Handlers.button($("#muteButton"),(()=>this.toggleMuted())),$("#muteButton").show();let e=()=>{let e=Panopto.GlobalResources[this.flowplayer.muted?"Embed_Muted":"Embed_Unmuted"];$("#muteButton").attr("title",e)};this.flowplayer&&this.flowplayer.on("mute",(()=>e())),this.flowplayer&&e()}toggleMuted(e){this.flowplayer&&(e=void 0===e?!this.flowplayer.muted:!!e,this.isMobile&&!e?this.flowplayer.volume(r.maxVolume/100):this.flowplayer.mute(e)),this.timelineController&&(e=void 0===e?!this.timelineState.muted:!!e,this.timelineController.muted(e))}configureVolumeSlider(){Panopto.Core.UI.Handlers.hoverOrDrag($("#volumeControls"),(e=>{this.player.toggleClass("volume-active",e)}));let e=$("#volumeSlider");e.slider({min:0,max:100,step:1,orientation:"horizontal",slide:(e,i)=>t(i.value,{updateSlider:!1})}),e.find("a.ui-slider-handle").attr("tabindex",r.controlButtonTabindex),this.flowplayer&&this.flowplayer.on("volume",(()=>{let e=100*this.flowplayer.volumeLevel;t(e,{updatePlayer:!1})}));let t=(t,{updateSlider:i=!0,updatePlayer:o=!0}={})=>{i&&e.slider("value",t),o&&(this.flowplayer&&this.flowplayer.volume(t/100),this.timelineController&&this.timelineController.volume(t/100),0===t&&(this.flowplayer&&this.flowplayer.mute(!0),this.timelineController&&this.timelineController.muted(!0))),$("#volumeLevel").css("width",t+"%")};const i=this.startMuted?0:this.initialVolume;t(i),Panopto.Core.UI.Accessibility.slider(e,(e=>Panopto.GlobalResources.ViewerPlus_ARIA_PercentValue.format(e)),Panopto.GlobalResources.Embed_Volume)}configurePlaybackSpeedControls(){let e=_.template($("#playbackSpeedTemplate").html());_.each(r.playbackSpeeds,(t=>{let i=$(e({speed:t,displaySpeed:this.getDisplaySpeed(t)}));i.insertAfter($("#playbackSpeedTemplate")),1===t&&i.toggleClass(r.selectedClass),Panopto.Core.UI.Handlers.button(i,((e,t)=>{this.requestSpeed($(e).data("speed")),this.toggleMenu(r.menus.playbackSpeed,!1),$("#playbackSpeedButton").focus().toggleClass(r.clickedClass,"click"===t.type)}))})),Panopto.Core.UI.Handlers.key($("#playbackSpeedMenu, #playbackSpeedButton"),((e,t)=>{this.showControls(r.controlDisplayDuration);let i=_.contains([o.RightArrow,o.UpArrow],t.which);if($(e).is("#playbackSpeedMenu")){let e=$(document.activeElement)[i?"prev":"next"](".item");e.length&&this.focusMenuItem(e)}else this.requestSpeed(i)}),[o.UpArrow,o.DownArrow,o.LeftArrow,o.RightArrow],{preserveExisting:!0}),this.flowplayer&&this.flowplayer.on("speed",(()=>this.displaySpeed(this.flowplayer.currentSpeed))),this.initialPlaySpeed!==PanoptoViewer.PlaySpeed.Normal&&this.setSpeed(this.initialPlaySpeed)}configureKeyHandler(){$(document).on("keydown",(e=>{if($(e.target).closest("#eventOverlay").length)return;if(this.showControls(r.controlDisplayDuration),e.ctrlKey||e.metaKey||e.altKey)return;let t=!1,i=e.which;switch(i){case o.Space:this.isLiveBroadcast||this.togglePlayState();break;case o.Home:case o.End:this.requestSeekTo(i===o.Home?0:10);break;case o.UpArrow:case o.DownArrow:case o.LeftArrow:case o.RightArrow:let a=_.contains([o.RightArrow,o.LeftArrow],i),s=_.contains([o.RightArrow,o.UpArrow],i);if(e.shiftKey&&a)this.requestSpeed(s);else if(!e.shiftKey){let t=$(e.target).hasClass("fp-timeline");if(a||t){const e=s?10:-10;this.requestSeek(this.getPosition()+e)}else if(!a){let e=s?.1:-.1;this.flowplayer.volume(this.flowplayer.volumeLevel+e)}}break;case o.Zero:case o.One:case o.Two:case o.Three:case o.Four:case o.Five:case o.Six:case o.Seven:case o.Eight:case o.Nine:this.requestSeekTo(i-o.Zero);break;case o.Period:this.requestSeekTo();break;case o.M:this.flowplayer.mute();break;case o.F:this.toggleFullscreen();break;case o.C:this.nonNativeCaptionsAvailable&&this.activateCaptionsToggle();break;case o.A:this.initParams.AvailableAudioDescriptionLanguages.length&&this.activateAudioDescriptionsToggle();break;case o.Esc:this.menuOpen?(this.hideMenus(),this.playlistOverlay&&this.playlistOverlay.hide(),this.showControls(r.controlDisplayDuration)):this.autoHideEnabled?this.showControls(!1,{ignorePlayState:!0}):Panopto.Core.ElementHelpers.blurActiveElement();break;default:t=!0}t||e.preventDefault()}))}configureOrientationListener(){const e=e=>{this.isLandscape=e,this.setLayoutOrientation(this.isLandscape),this.eventOverlay&&this.eventOverlay.setProps({isLandscape:this.isLandscape}),PanoptoCore.Browser.$_android&&PanoptoCore.Browser.$_chrome&&this.toggleFullscreen(this.isLandscape)};PanoptoCore.Browser.attachOrientationChangeListener(e),e(PanoptoCore.Browser.isLandscape())}setLayoutOrientation(e){$("#eventOverlay").addClass("no-animation"),$("#embed").toggleClass("landscape",e),this.player[0].offsetHeight,$("#eventOverlay").removeClass("no-animation"),this.eventOverlayShown&&this.handleEventOverlayModeChanged({isOverlay:e})}configureProgressListener(){let t=0;this.flowplayer.on("progress",((i,o,a)=>{if(a===t)return;let s=e.Viewer.Logic.ContentLogic.getBlockingContent(this.quizzes,a);o.seeking||s||(s=e.Viewer.Logic.ContentLogic.getPausingContent(this.quizzes,t,a)),s&&this.showQuiz(s),t=a}))}showQuiz(e){if(this.quizPlayer)return;this.toggleEventOverlay(!1),this.nativeFullscreen&&(this.videoElement.webkitExitFullScreen(),this.nativeFullscreen=!1),this.player.toggleClass(r.quizLoadingClass,!0);let i=e.timeline[0];this.flowplayer.video.time!==i&&this.seek(i);let o=$.Deferred();this.flowplayer.seeking?this.flowplayer.one("seek",(()=>{this.flowplayer.pause(o.resolve)})):this.flowplayer.pause(o.resolve),o.then((()=>{this.quizPlayer=new t.QuizPlayer(e,{container:$("#quizContainer"),userId:Panopto.user.userId,invocationId:this.invocationId,sessionId:this.deliveryId}),this.quizPlayer.toggle(!1),this.quizPlayer.loadedCallback.add((()=>{this.player.toggleClass(r.quizLoadingClass,!1),this.quizPlayer.toggle(!0)})),this.quizPlayer.render()}))}getSeekPositionAfterQuiz(e){let t=e.timeline[0];return t+=r.quizSeekOffset,t}configureQuizResultsController(){const t=new PanoptoQuiz.QuizResultsController(this.quizzes,(e=>{this.quizPlayer.remove(),this.quizPlayer=null,this.seek(this.getSeekPositionAfterQuiz(e),(()=>{setTimeout((()=>this.flowplayer.resume()),0)}))}),(e=>{if(this.quizPlayer.remove(),this.quizPlayer=null,e.isSessionPlaybackBlocking){let t=e.timeline[0]-r.quizSeekOffset;t<0&&(t=0),this.seek(t)}else this.seek(this.getSeekPositionAfterQuiz(e),(()=>this.flowplayer.resume()))}),this.ltiOutcomeConfig,this.ltiAgsConfig);e.Viewer.QuizResultsController.setInstance(t)}togglePlayState(e){if(this.flowplayer)void 0===e&&(e=!this.flowplayer.playing),e!==this.flowplayer.playing&&(this.updatePlayControls(e),e?this.flowplayer.resume():this.flowplayer.pause());else if(this.timelineController){const e=this.timelineController.togglePlayState();this.updatePlayControls(e)}}updatePlayControls(e){this.player.toggleClass("is-playing",e),this.player.toggleClass("is-paused",!e),$("#playIcon").toggle(e),$("#pauseIcon").toggle(!e),$("#playIconContainer").finish().show().fadeOut(r.playIconPulseDuration)}isPlaying(){let e=!1;return this.timelineState?e=!this.timelineState.paused:this.flowplayer&&(e=this.flowplayer.playing),e}getPosition(){let e=0;return this.timelineState?e=this.timelineState.timelinePosition:this.flowplayer&&(e=this.flowplayer.video.time),e}getDuration(){let e=0;return e=this.timelineState?this.timelineState.duration:this.flowplayer.video.duration,e}seek(e,t){this.timelineController?("boolean"==typeof e&&(e=this.timelineState.timelinePosition+this.timelineState.duration/10*(e?1:-1)),this.lastTimelinePositionRequested=e,this.timelineController.seek(e,t)):this.flowplayer.seek(e,t)}setBitrate(e){this.timelineController&&this.timelineController.bitrate(e),PanoptoCore.setUserSetting("defaultBitrateMBR",e.toString())}requestSeek(e,t){const i=this.timelineSeekHelper.getValidPosition(e);void 0!==i?this.seek(i,t):t?.()}requestSeekTo(e){let t;if(t=void 0!==e?this.getDuration()/10*e:this.lastTimelinePositionRequested,void 0===t)return;const i=this.timelineSeekHelper.getValidPosition(t);void 0!==i&&this.seek(i)}setVolume(e){this.timelineController?this.timelineController.volume(e):this.flowplayer&&this.flowplayer.volume(e)}resume(){this.timelineController?this.timelineController.resume():this.flowplayer&&this.flowplayer.resume()}pause(){this.timelineController?this.timelineController.pause():this.flowplayer&&this.flowplayer.pause()}mute(e){this.timelineController?this.timelineController.muted(e):this.flowplayer&&this.flowplayer.mute(e)}stop(){this.flowplayer&&this.flowplayer.stop(),this.timelineController&&(this.timelineController.pause(),this.seek(0))}showControls(e,{slowFade:t=!1,ignorePlayState:i=!1}={}){let o=!!e||_.isUndefined(e);if(this.menuOpen||this.flowplayer&&!this.flowplayer.playing&&!o&&!i||this.timelineController&&this.timelineState.paused&&!o&&!i)return;const a=()=>{this.hideOverlay||(this.player.toggleClass("is-mouseover",o),this.player.toggleClass("is-mouseout",!o)),this.flowplayer&&!this.flowplayer.splash&&$("#embed").toggleClass("overlay-controls",o),this.timelineController&&(this.timelineState.activePrimary&&$("#embed").toggleClass("overlay-controls",o),this.player.find("#overlay").css("z-index",o?11:1)),o||$(document.activeElement).blur()};!o&&t?(this.player.add($("#embed")).addClass("slow-fade"),a(),this.player[0].offsetHeight,this.player.add($("#embed")).removeClass("slow-fade")):a(),clearTimeout(this.controlsHideTimeoutId),this.autoHideEnabled&&"number"==typeof e&&(this.controlsHideTimeoutId=window.setTimeout((()=>this.showControls(!1,{slowFade:!0})),e))}toggleMenu(e,t){t=void 0===t?!$(e.menuSelector).is(".shown"):!!t,$(e.menuSelector).toggleClass("shown",t),$(e.buttonSelector).toggleClass("on",t),this.menuOpen=t}hideMenus(){_.each(r.menus,(e=>this.toggleMenu(e,!1)))}focusMenuItem(e){e.parent().find(".item").attr("tabindex",-1),e.attr("tabindex",r.controlButtonTabindex),e.focus()}activateCaptionsToggle(e){this.toggleCaptions(e),PanoptoCore.setUserSetting("embedCaptions",this.captionsDisplayed),this.initParams.IsAudioOnly&&this.autoHideEnabled&&this.showControls(r.playDisplayDuration)}activateAudioDescriptionsToggle(e){this.toggleAudioDescriptions(e),this.initParams.IsAudioOnly&&this.autoHideEnabled&&this.showControls(r.playDisplayDuration)}handleCaptionLanguageChanged(e){this.selectedCaption=e,PanoptoCore.setUserSetting(this._selectedCaptionSetting,this.selectedCaption),this.loadSubtitleTrack()}handleCaptionLanguageChangedAndToggleUI(e){this.handleCaptionLanguageChanged(e),this.toggleCaptions(!0),PanoptoCore.setUserSetting("embedCaptions",!0),this.timelineNavigationControls?.setProps({captionsLanguage:e})}handleADLanguageChanged(e){this.selectedAudioDescriptionLanguage=e,PanoptoCore.setUserSetting(this._selectedAudioDescriptionSetting,this.selectedAudioDescriptionLanguage),this.loadAudioDescriptionTrack()}handleADLanguageChangedAndToggleUI(e){this.handleADLanguageChanged(e),this.toggleAudioDescriptions(!0),this.timelineNavigationControls?.setProps({audioDescriptionsLanguage:e})}loadSubtitleTrack(){"none"!==this.interactivity&&this.eventOverlay.setProps({selectedLanguage:this.selectedCaption});try{this.timelineController?this.getCaptions(this.deliveryId,this.inviteId,this.selectedCaption):this.flowplayer.loadSubtitles(Math.max(this.initParams.AvailableLanguages.indexOf(this.selectedCaption),0))}catch{}}loadAudioDescriptionTrack(){"none"!==this.interactivity&&this.eventOverlay.setProps({selectedAudioDescriptionLanguage:this.selectedAudioDescriptionLanguage}),this.timelineController&&this.getAudioDescriptions(this.deliveryId,this.inviteId,this.selectedAudioDescriptionLanguage)}toggleNativeCaptions(e){_.each(this.videoElement.textTracks,(e=>{e.mode="disabled"})),this.videoElement.textTracks.length>0&&(this.videoElement.textTracks[0].mode=e?"showing":"disabled")}toggleCaptions(t){this.captionsDisplayed=void 0===t?!this.captionsDisplayed:t,$("#captionsButton").toggleClass("on",this.captionsDisplayed).toggleClass("off",!this.captionsDisplayed).prop("title",this.captionsDisplayed?Panopto.GlobalResources.Embed_Tooltip_HideCaptions:Panopto.GlobalResources.Embed_Tooltip_ShowCaptions);let i=this.captionsDisplayed?e.ImageHelpers.getImageUrl("Viewer/closed-caption.svg"):e.ImageHelpers.getImageUrl("Viewer/closed-caption-outline.svg");this.timelineController?this.timelineController.captionVisible(this.captionsDisplayed):this.captionsDisplayed?(this.loadSubtitleTrack(),this.isLiveBroadcast&&!this.nonNativeCaptionsAvailable&&this.videoElement.textTracks.length&&this.toggleNativeCaptions(!0)):(this.flowplayer.disableSubtitles(),this.isLiveBroadcast&&!this.nonNativeCaptionsAvailable&&this.toggleNativeCaptions(!1)),$("#captionSvg").replaceWith(`<img class="material-icons" id="captionSvg" src="${i}" crossorigin onload="SVGInject(this)" />`)}toggleAudioDescriptions(t){this.audioDescriptionsActivated=t??!this.audioDescriptionsActivated,PanoptoCore.setUserSetting("audioDescriptions",this.audioDescriptionsActivated),$("#audioDescriptionsButton").toggleClass("on",this.audioDescriptionsActivated).toggleClass("off",!this.audioDescriptionsActivated).prop("title",this.audioDescriptionsActivated?Panopto.GlobalResources.Embed_Tooltip_DisableAudioDescriptions:Panopto.GlobalResources.Embed_Tooltip_EnableAudioDescriptions);let i=this.audioDescriptionsActivated?e.ImageHelpers.getImageUrl("Viewer/audio-description.svg"):e.ImageHelpers.getImageUrl("Viewer/audio-description-disabled.svg");$("#audioDescriptionSvg").replaceWith(`<img class="material-icons" id="audioDescriptionSvg" src="${i}" crossorigin onload="SVGInject(this)" />`),this.timelineController?.setAudioDescriptionsEnabled(this.audioDescriptionsActivated)}setSpeed(e){"boolean"==typeof e&&(e=this.convertSpeedFromBoolean(e)),this.flowplayer?(this.flowplayer.speed(e),this.flowplayer.one("speed",(()=>{this.loggerSpeedChangeHandler&&this.loggerSpeedChangeHandler()}))):this.timelineController&&this.timelineController.playbackRate(e)}requestSpeed(e){"boolean"==typeof e&&(e=this.convertSpeedFromBoolean(e));const t=this.timelineSeekHelper.getValidPlaySpeed(e,this.getPosition());void 0!==t&&this.setSpeed(t)}convertSpeedFromBoolean(e){const t=_.indexOf(r.playbackSpeeds,this.flowplayer?.currentSpeed||this.timelineState?.playbackRate||1),i=t+(e?1:-1),o=i>=0&&i<r.playbackSpeeds.length;return r.playbackSpeeds[o?i:t]}displaySpeed(e){$("#playbackSpeedButton .selected-value").text(this.getDisplaySpeed(e)),$(`#playbackSpeedMenu .${r.selectedClass}`).removeClass(r.selectedClass),$(`#playbackSpeedMenu [data-speed='${e}']`).addClass(r.selectedClass)}getDisplaySpeed(e){let t=Number(e).toLocaleString(Panopto.lang);return Panopto.GlobalResources.Embed_PlaybackSpeedFormat.format(t)}showNextDelivery(){let e=$("#nextDelivery"),t={url:i.setQueryParameters(location.href,{id:this.delivery.nextDelivery.id,autoplay:!0}),title:this.delivery.nextDelivery.title,description:this.delivery.nextDelivery.description,duration:this.delivery.nextDelivery.duration,thumbUrl:this.delivery.nextDelivery.thumbUrl,folderName:this.delivery.folder.name};if(t.url){e.show(),$("#player, #pipPlayer, #gridPlayers, #captionPlayer, #eventOverlay").hide(),Panopto.Core.UI.Components.nextDelivery(e,t,Panopto.GlobalResources,(()=>{$("#player, #pipPlayer, #gridPlayers, #captionPlayer, #eventOverlay").show(),e.hide(),this.flowplayer?.play(),this.timelineController?.resume()}));let i=($(window).height()-e.height())/2;e.css({"padding-top":i+"px","padding-bottom":i+"px"})}}handleError(){switch(this.initParams.ErrorCode){case PanoptoViewer.Data.ErrorCode.SiteDisabled:this.showErrorMessage(Panopto.GlobalResources.Embed_SiteDisabled);break;case PanoptoViewer.Data.ErrorCode.LoginRequired:this.showCallToAction({link:{id:"loginLink",url:this.loginUrl,text:Panopto.GlobalResources.Embed_LoginMessage}});break;case PanoptoViewer.Data.ErrorCode.AccessRequired:this.showCallToAction({message:Panopto.GlobalResources.Embed_RequestAccess,link:{id:r.requestAccessLinkId,url:"#",text:Panopto.GlobalResources.Embed_RequestAccessLink}}),Panopto.Core.UI.Handlers.button($("#"+r.requestAccessLinkId),(()=>this.requestAccess()));break;case PanoptoViewer.Data.ErrorCode.NotInAvailabilityWindow:this.showCallToAction({message:Panopto.GlobalResources.Embed_NotInAvailabilityWindow,link:{id:"availabilityLink",url:this.sessionListUrl,target:"_blank",text:Panopto.GlobalResources.ViewerPlus_WatchSomethingElse}});break;case PanoptoViewer.Data.ErrorCode.NetworkAccessDenied:this.showCallToAction({message:Panopto.viewer.networkAccessDeniedMessage});break;case PanoptoViewer.Data.ErrorCode.PodcastRequired:this.showCallToAction({message:Panopto.GlobalResources.Embed_VideoNotReady}),$("#callToActionContainer .spinner").show();break;case PanoptoViewer.Data.ErrorCode.InvalidUrl:this.showErrorMessage(Panopto.GlobalResources.Embed_InvalidUrl);break;case PanoptoViewer.Data.ErrorCode.InvalidDelivery:this.showErrorMessage(Panopto.GlobalResources.Embed_InvalidDelivery);break;case PanoptoViewer.Data.ErrorCode.InvalidPlaylist:case PanoptoViewer.Data.ErrorCode.InvalidPlaylistUrl:this.showErrorMessage(Panopto.GlobalResources.Embed_InvalidPlaylist);break;case PanoptoViewer.Data.ErrorCode.InvalidPlaylistNoSessions:this.showErrorMessage(Panopto.GlobalResources.Embed_PlaylistHasNoViewableSessions);break;case PanoptoViewer.Data.ErrorCode.HasPendingMergeOrCopyJobs:this.showErrorMessage(Panopto.GlobalResources.Embed_HasPendingMergeOrCopyJobs);break;case PanoptoViewer.Data.ErrorCode.Archived:this.renderArchiveMessage();break;case PanoptoViewer.Data.ErrorCode.UnknownError:default:this.showErrorMessage(Panopto.GlobalResources.Embed_UnknownError)}}showErrorMessage(e){this.player.hide(),$("#errorMessageWrapper").show(),$("#errorMessage").text(e),$("#absoluteBackButton").toggle(this.hasBackButton)}showCallToAction(e){if($("#embed").addClass("is-call-to-action"),e.link){e.message=e.message||"{0}",e.link.target=e.link.target||"_self";let t=_.template($("#callToActionLinkTemplate").html())(e.link),i=String.format(e.message,t);$("#callToAction").html(i)}else $("#callToAction").text(e.message)}appendDiagnostics(e){$("#diagnostics").append(e).show()}requestAccess(){let e={deliveryId:this.deliveryId},t=()=>{this.showCallToAction({message:Panopto.GlobalResources.Embed_RequestAccessFailure,link:{id:r.requestAccessLinkId,url:"#",text:Panopto.GlobalResources.Embed_RequestAccessFailureTryAgain}}),Panopto.Core.UI.Handlers.button($("#"+r.requestAccessLinkId),(()=>this.requestAccess()))};Panopto.Util.callWebMethod({methodName:"RequestAccess",serviceURL:`${Panopto.appRoot}/Services/Data.svc`,params:e,onSuccess:e=>{e?this.showCallToAction({message:Panopto.GlobalResources.Embed_RequestAccessSuccess}):t()},onFailure:()=>t(),loadingIndicator:""})}requestRestoreFromArchive(e){const t=[{DeliveryID:e}];let i=()=>{this.showCallToAction({message:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchiveFailure,link:{id:r.restoreFromArchiveLinkId,url:"#",text:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchive}}),Panopto.Core.UI.Handlers.button($("#"+r.restoreFromArchiveLinkId),(()=>this.requestRestoreFromArchive(e)))};Panopto.Core.ServiceInterface.Rest.Sessions.batchRestoreFromArchive(t,(()=>this.showCallToAction({message:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchiveSuccess})),(()=>i()),$.noop)}configurePlaylistOverlay(t){$("#overlay").addClass("playlist-mode");let o=!this.playlistAdvance;this.playlistOverlay=new e.Core.UI.Components.PlaylistOverlay($("#playlistOverlay"),$("#playlistButton"),this.playlistId,this.playlistDeliveryId,e.Core.UI.Components.PlaylistOverlaySkin.Embedded,{includeEmbedViewableOnly:!0},o,t&&!this.initParams.ErrorCode,new e.Core.API.Rest.PlaylistWithSessionsService),this.playlistOverlay.onPlayItem((e=>{if(e===this.deliveryId)this.initParams.ErrorCode||(this.showCopyrightNoticeIfRequired(),this.flowplayer&&(this.flowplayer.splash?this.loadVideo():this.flowplayer.resume()),this.timelineController&&(this.player.hasClass("is-ready")?this.timelineController.resume():this.loadVideo()));else{let t=i.setQueryParameters(location.href,{pid:this.playlistId,id:e,advance:!0});location.replace(t)}}));let a=e=>{this.menuOpen&&this.hideMenus(),this.eventOverlayShown&&this.toggleEventOverlay(!1),e?this.showControls(!1,{ignorePlayState:!0}):this.showControls(r.controlDisplayDuration),$("#embed").toggleClass("overlay-controls",!e),this.menuOpen=e,$("#appBackButton").toggle(!e&&this.hasBackButton);let t=!e&&this.showTitle;$("#title").toggle(t),$("#player").toggleClass("title-shown",t),!this.flowplayer?.splash&&this.player.hasClass("is-ready")||($("#logoContainer").toggle(!e),$("#playIconContainer").toggle(!e&&!this.isMobile),$("#splashPlayIconContainer").toggle(!e&&this.isMobile))};this.playlistOverlay.onToggle((e=>a(e))),a(o),$("#playlistOverlay").on("click touchend",(e=>e.stopPropagation()))}ensureMobileCompatibleManifest(e){const t=/_hlsbc/i.test(e),i=new RegExp(Panopto.viewer.mobileBroadcastUserAgentRegex,"i").test(navigator.userAgent);return this.isLiveBroadcast&&t&&i&&(e=e.replace("master.m3u8","master2.m3u8")),e}updateScormProgress(){setInterval((()=>{this.flowplayer?this.scormControl.updateProgress(this.flowplayer.video.time):this.timelineController&&this.scormControl.updateProgress(this.timelineState.timelinePosition)}),e.Viewer.Constants.TimedSyncRate)}enableSeekAndVspControls(){this.player.removeClass(r.seekDisabledClass),this.player.find(".fp-timeline").attr("tabindex",0),this.vspSupported&&($("#playbackSpeedButton").show(),this.timelineSeekBar?.setProps({disabled:!1}),this.timelinePlaybackControls?.setProps({seekDisabled:!1}),this.timelineMobilePlaybackControls?.setProps({seekDisabled:!1}),this.timelineNavigationControls?.setProps({vspDisabled:!1}))}disableSeekAndVspControls(){if(this.player.addClass(r.seekDisabledClass),this.player.find(".fp-timeline").removeAttr("tabindex"),$("#playbackSpeedButton").hide(),this.timelineSeekBar?.setProps({disabled:!0}),this.timelinePlaybackControls?.setProps({seekDisabled:!0}),this.timelineMobilePlaybackControls?.setProps({seekDisabled:!0}),this.timelineNavigationControls?.setProps({vspDisabled:!0}),this.flowplayer&&PanoptoCore.Browser.$_iphone){let e=this.videoElement.currentTime;this.videoElement.addEventListener("timeupdate",(()=>{this.videoElement.seeking||(e=this.videoElement.currentTime)})),this.videoElement.addEventListener("seeking",(()=>{this.videoElement.currentTime!==e&&this.nativeFullscreen&&(this.videoElement.currentTime=e)})),this.videoElement.addEventListener("ended",(()=>{e=0}))}}renderArchiveMessage(){const t=e=>{if(e.isRestorable)this.showCallToAction({message:Panopto.GlobalResources.Embed_Archived,link:{id:r.restoreFromArchiveLinkId,url:"#",text:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchive}}),Panopto.Core.UI.Handlers.button($("#"+r.restoreFromArchiveLinkId),(()=>this.requestRestoreFromArchive(e.deliveryId)));else if(e.archiveRestorationRequestTime){const t=moment(e.archiveRestorationRequestTime).locale(Panopto.lang).fromNow(),i=moment.max(moment(e.archiveRestorationEstimatedCompletionTime),moment()).locale(Panopto.lang).fromNow();this.showErrorMessage(Panopto.GlobalResources.Archived_RestoreInProgress.format(t,i))}else this.showErrorMessage(Panopto.GlobalResources.Embed_ArchivedRestoreUnavailable)},i=e.API.Rest.ServiceFactory.getArchiveService();this.deliveryId?i.getDeliveryArchiveStatus(this.deliveryId,t,(()=>this.showErrorMessage(Panopto.GlobalResources.Embed_ArchivedRestoreUnavailable))):this.inviteId&&i.getDeliveryArchiveStatusByInviteId(this.inviteId,t,(()=>this.showErrorMessage(Panopto.GlobalResources.Embed_ArchivedRestoreUnavailable)))}initializeAudioDescriptions(){this.initParams.AvailableAudioDescriptionLanguages=PanoptoViewer.AudioDescriptionPlayer.filterToSupportedLanguages(this.initParams.AvailableAudioDescriptionLanguages),this.audioDescriptionsActivated=!!this.initParams.AvailableAudioDescriptionLanguages.length&&!0===PanoptoCore.getUserSetting("audioDescriptions"),this.initParams.AvailableAudioDescriptionLanguages.length&&(this.selectedAudioDescriptionLanguage=PanoptoCore.getUserSetting(this._selectedAudioDescriptionSetting),-1===this.initParams.AvailableAudioDescriptionLanguages.indexOf(this.selectedAudioDescriptionLanguage)&&(this.selectedAudioDescriptionLanguage=this.initParams.AvailableAudioDescriptionLanguages[0])),this.audioDescriptionsActivated&&(this.autoPlayRequested=!1)}showCopyrightNoticeIfRequired(){"pending"!==this.checkCopyrightNoticeRequirement.state()||this.copyrightNotice.isShowingNotice()||(this.initParams.ShowCopyrightNotice?this.copyrightNotice.showNotice(this.checkCopyrightNoticeRequirement.resolve):this.checkCopyrightNoticeRequirement.resolve())}}r.hlsMimeType="application/x-mpegurl",r.mp4MimeType="video/mp4",r.maxVolume=100,r.requestAccessLinkId="requestAccessLink",r.restoreFromArchiveLinkId="restoreFromArchiveLink",r.hoverCaptionsMinHeight=175,r.controlDisplayDuration=3e3,r.playDisplayDuration=500,r.playIconPulseDuration=750,r.quizSeekOffset=.5,r.controlButtonTabindex=2,r.menus={playbackSpeed:{buttonSelector:"#playbackSpeedButton",menuSelector:"#playbackSpeedMenu"}},r.playbackSpeeds=PanoptoCore.mapEnum(PanoptoViewer.PlaySpeed,((e,t)=>t)),r.clickedClass=Panopto.Core.Constants.ClickedClass,r.selectedClass=Panopto.Core.Constants.SelectedClass,r.quizLoadingClass="quiz-loading",r.seekDisabledClass="no-seek",r.flowplayerGlobal=flowplayer,t.EmbeddedViewer=r}(e.Embed||(e.Embed={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){var t=PanoptoCore.VoidCallback;class i{get loadedCallback(){return this._loadedCallback}constructor(e,i){this.quiz=e,this._loadedCallback=new t,this.visible=!0,this.container=i.container,this.url=String.format(this.quiz.url,i.userId,i.invocationId,i.sessionId)+"&embedded=true"}toggle(e){this.visible=e,this.iframe&&this.iframe.toggle(e)}render(){this.iframe=$(i.template(this.quiz)).appendTo(this.container),this.iframe.toggle(this.visible),this.iframe.on("load",(()=>this._loadedCallback.fire())),this.iframe.prop("src",this.url)}remove(){this.iframe.remove()}}i.template=_.template('<iframe class="quiz-player"></iframe>'),e.QuizPlayer=i}(e.Embed||(e.Embed={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Core=Panopto.Core||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.GlobalResources=Panopto.GlobalResources||{},function(e){!function(e){class t{}let i;t.TimedSyncRate=30,t.ControlSyncRate=1e3,t.SecondarySyncThreshold=1,t.SecondarySynchronizingUpdateRateMillis=50,t.InitialSecondaryThreshold=5,t.SecondaryStreamOffset=1.5,t.MinSegmentGap=1,t.ContiguousSegmentThreshold=.2,t.EndPositionThreshold=.1,t.BroadcastEndedIncrement=5e3,t.QualityReportThreshold=2,t.BroadcastStreamRetryTimeout=5e3,t.LivePositionTolerance=1,t.BroadcastEndThreshold=1,t.MaxPositionInterpolation=500,t.BufferingTimeoutThreshold=1e3,t.BadSeekThreshold=.1,t.NativePositionFallbackRegion=1,t.CircularLogBufferSize=2048,t.SecondaryContentClass="secondary-content",t.SecondaryPlayerClass="secondaryPlayer",t.SlideDeckId="slideDeck",t.ScreenCaptureClass="screen-capture",t.ObjectVideoTabClass="object-video",t.UrlTabClass="url",t.TocIconClass="toc",t.YouTubeIconClass="youtube",t.SmartChapterIconClass="smart-chapter",t.SmartChapterLinkIconClass="smart-chapter-link",t.SlideDeckTabClass="slide-deck",t.PrimaryTabHeaderClass="primary-header",t.SecondaryTabHeaderClass="secondary-header",t.RecentBroadcastThreshold=144e5,t.PlayKeyCode=32,t.RewindKeyCode=37,t.ForwardKeyCode=39,t.VolumeUpKeyCode=38,t.VolumeDownKeyCode=40,t.MuteKeyCode=77,t.VolumeIncrement=10,t.PositionIncrement=10,t.MinVolume=0,t.MaxVolume=100,t.InitialVolume=100,t.SilverlightVersion="4.0.50401.0",t.PlaySpeedSilverlightVersion="5.0",t.QuickRewindSeconds=10,t.QuickForwardSeconds=30,t.FullScreenControlInterval=3,t.EditJumpSeconds=5,t.TOCMaxLength=200,t.EditorTimelineEndOffsetSeconds=.01,t.DisplayTimePrecisionMultiplier=Math.pow(10,Panopto.Core.Constants.DisplayTimeMillisecondPrecision),t.UrlEventClosenessTolerance=.1,t.BoundaryCutTolerance=.1,t.StreamDeleteCutTolerance=.01,t.LeftPaneRatio=.35,t.LeftPaneMinWidth=460,t.RightPaneMinWidth=480,t.HeaderBuffer=60,t.MaxDesktopTitleCharacters=120,t.MaxMobileTitleCharacters=60,t.EventRegionMinHeight=300,t.PlayerMinHeight=50,t.LeftPlayerDefaultHeight=260,t.LiveNotesClass="live-notes",t.MaxInlineSecondaryTabs=3,t.CollapseSecondaryTabsWidth=1200,t.SliderDragThreshold=2,t.InputMargin=14,t.InputOptionsMargin=4,t.ScrollBarWidth=20,t.AudioOnlyMinimumWidth=2,t.ThumbnailScrollTimeout=5e3,t.EventScrollTimeout=5e3,t.FlyoutTimeout=2e3,t.MissingSeekedEventTimeout=5e3,t.BaseUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.appRoot,t.EditorUrl=t.BaseUrl+"/Pages/Viewer.aspx?id={0}&edit=true",t.SessionListUrl=t.BaseUrl+"/Pages/Sessions/List.aspx",t.SilverlightEditorUrlTemplate=t.BaseUrl+"/Pages/Editor/Default.aspx#{0}",t.SlideImageUrl=t.BaseUrl+"/Pages/Viewer/Image.aspx",t.ThumbUrl=t.BaseUrl+"/Pages/Viewer/Thumb.aspx",t.DummyPDFUrl=t.BaseUrl+"/Scripts/PluginDetect/empty.pdf",t.FlashPlayerUrl="https://get.adobe.com/flashplayer",t.SinglePageAppUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.relativeSinglePageAppUrl,t.QuizEditUrlTemplate=t.SinglePageAppUrl+"quiz-configure/{0}?sessionId={1}",t.YouTubeEditUrlTemplate=t.SinglePageAppUrl+"youtubeEmbed/configure/{0}",t.HlsLevelFileNames=["index.m3u8","index2.m3u8"],t.JoinChannelOptionValue="joinChannel",t.SearchExpandDuration=400,t.FadeInterval=150,t.PlaySpeedResourceString="ViewerPlus_Speeds_{0}",t.BitrateResourcePrefixString="ViewerPlus_Bitrates_",t.BitrateResourceString=t.BitrateResourcePrefixString+"{0}",t.SearchTypeResourceString="ViewerPlus_Search_{0}",t.BitrateLevels=[Panopto.GlobalResources[t.BitrateResourcePrefixString+"Low"],Panopto.GlobalResources[t.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[t.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[t.BitrateResourcePrefixString+"High"]],t.PluginDetectPDFReader="PDFReader",t.SortRelevanceValue="relevance",t.SortTimeValue="time",t.SearchSortOrders=[{value:t.SortRelevanceValue,name:Panopto.GlobalResources.ViewerPlus_SortByRelevance},{value:t.SortTimeValue,name:Panopto.GlobalResources.ViewerPlus_SortByTime}],t.SearchRateLimitMilliseconds=1e3,t.MP4MimeType="video/mp4",t.HLSMimeType="application/x-mpegurl",t.Hive="Hive",t.Kollective="Kollective",t.KollectiveLongPollUrlBase="/api/v1/longpoll?ts={0}&ktoken=",t.LTIPage="/Panopto/LTI/LTI.aspx",t.OutcomeFormat="resultScore={0}&lis_result_sourcedid={1}&oauth_consumer_key={2}&lis_outcome_service_url={3}&lti_message_type=panopto_outcome_pox_response&lti_version=LTI-1p0",t.AGSEndpointFormat="/Panopto/lti/adv/platforms/{0}/agsScore",e.Constants=t,function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.LiveNotes=3]="LiveNotes"}(i=e.ViewMode||(e.ViewMode={})),function(e){e.HttpHeaders={Date:"date",LastModified:"last-modified"}}(t=e.Constants||(e.Constants={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),Panopto.Core.ViewerPlayState=Panopto.Core.ViewerPlayState||{},Panopto.Viewer.PlayState=function(e){return e.Playing=Panopto.Core.ViewerPlayState.Playing,e.Paused=Panopto.Core.ViewerPlayState.Paused,e.Stopped=Panopto.Core.ViewerPlayState.Stopped,e.Buffering=Panopto.Core.ViewerPlayState.Buffering,e}(Panopto.Viewer.PlayState||{}),function(e){!function(e){class t{static getInstance(){return t.instance}static setInstance(e){t.instance=e}}e.QuizResultsController=t}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),Panopto.Viewer.Players=Panopto.Viewer.Players||{},function(e){!function(t){(t.Data||(t.Data={})).Delivery=class{constructor(t,i,o){let a=Panopto.Viewer.Data,s=e.Viewer.Constants,n=t.Delivery.SessionName,r=Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(t.Delivery.SessionStartTime),l=t.Delivery.IsActiveBroadcast,d=t.Delivery.IsBroadcast&&t.Delivery.IsViewerEncodeComplete&&(new Date).getTime()-r.getTime()<=s.RecentBroadcastThreshold;const p=_.chain(t.Delivery.Streams).filter((e=>"Archival"===e.StreamTypeName)).filter((e=>{const t=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType;return t===PanoptoViewer.Services.Panopto_Shared_MediaFileType.ism||t===PanoptoViewer.Services.Panopto_Shared_MediaFileType.wmv})).value().length>0,h=_.chain(t.Delivery.Streams).filter((e=>{if(!e.StreamUrl)return PanoptoCore.Logging.Logger.verbose("Delivery.ctor: Missing stream URL."),!1;const t=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType;let i=!0;return t!==PanoptoViewer.Services.Panopto_Shared_MediaFileType.ism&&t!==PanoptoViewer.Services.Panopto_Shared_MediaFileType.wmv&&t!==PanoptoViewer.Services.Panopto_Shared_MediaFileType.unknown&&null!=t||(PanoptoCore.Logging.Logger.verbose(`Delivery.ctor: Legacy media type is not playable (enum: ${t}, str: ${PanoptoViewer.Services.Panopto_Shared_MediaFileType[t]}).`),i=!1),i})).value();let c,u,g,m,y=!1;if(h.length>0&&(t.Delivery.IsViewerEncodeAvailable||l)&&!i)PanoptoCore.Logging.Logger.info("Delivery.ctor: parsing and playing regular streams."),({primaryStreams:c,secondaryStreams:u,activePrimary:g,screenCaptureStream:m}=this.parseStreams(h,n,l,o??!1));else if(t.Delivery.PodcastStreams?.length>0){PanoptoCore.Logging.Logger.info("Delivery.ctor: parsing and playing podcast stream."),y=!0,({primaryStreams:c,secondaryStreams:u,activePrimary:g}=this.parseStreams(t.Delivery.PodcastStreams,n,l,!1));const e=_.find(t.Delivery.Streams,(e=>"Archival"===e.StreamTypeName))?.PublicID;c.forEach((t=>t.id=e))}else c=[],u=[];let{slides:v,documents:P,thumbnails:b,contents:C,channels:f}=this.parseEvents(t.Delivery.Timestamps,t.Delivery.EventTargets,t.Delivery.PublicNotesStreams,t.Delivery.Duration,m);this.title=n,this.id=t.Delivery.PublicID,this.sessionId=t.SessionId,this.webcastVersionId=t.Delivery.WebcastVersionId,this.sourceDeliveryId=t.Delivery.SourceDeliveryId,this.date=r,this.duration=t.Delivery.Duration,this.description=t.Delivery.SessionAbstract,this.ownerId=t.Delivery.OwnerId,this.ownerFullName=t.Delivery.OwnerDisplayName,this.ownerBio=t.Delivery.OwnerBio,this.ownerIsOverQuota=t.Delivery.OwnerIsOverQuota,this.invocationId=t.InvocationId,this.embedUrl=t.EmbedUrl,this.downloadUrl=t.DownloadUrl,this.podcastCompleted=t.PodcastCompleted,this.broadcastRefreshInterval=1e3*t.BroadcastRefreshInterval,this.webcastApiRefreshInterval=1e3*t.WebcastPingIntervalInSeconds,this.broadcastSegmentBackoff=t.BroadcastSegmentBackoff,this.allowPublicNotes=t.AllowPublicNotes,this.hasAnyLinks=t.Delivery.HasAnyLinks,this.hasQuiz=t.Delivery.HasQuiz,this.firstQuizOffset=t.Delivery.FirstQuizOffset,this.hasCaptions=t.Delivery.HasCaptions,this.hasAudioDescriptions=t.Delivery.HasAudioDescriptions,this.availableLanguages=t.Delivery.AvailableLanguages.map((e=>null===e?void 0:e)),this.availableAudioDescriptionLanguages=t.Delivery.AvailableAudioDescriptionLanguages,this.isBroadcast=l,this.isViewable=l&&!!g||t.Delivery.IsViewerEncodeComplete&&t.Delivery.IsViewerEncodeAvailable,this.isEmbedViewable=this.isViewable||c.length>0,this.isReadyForEditing=t.Delivery.IsReadyForEditing,this.isReferenceCopy=t.Delivery.IsReferenceCopy,this.rehydrationAvailable=t.Delivery.RehydrationAvailable,this.isPurgedEncode=t.Delivery.IsPurgedEncode,this.isPurgedLegacyEncode=t.Delivery.IsPurgedLegacyEncode,this.requiresAdvancedEditor=t.Delivery.RequiresAdvancedEditor,this.broadcastEnded=t.Delivery.BroadcastEnded,this.broadcastInterrupted=t.Delivery.BroadcastInterrupted,this.isRecentBroadcast=d,this.isPrimaryAudioOnly=t.Delivery.IsPrimaryAudioOnly,this.requiresSilverlight=p,this.flowPlayerEnabled=Panopto.viewer.flowplayerEnabled&&!p,this.multiBitrateEnabled=g?.mediaFileType===PanoptoViewer.Services.Panopto_Shared_MediaFileType.hls,this.playSpeedEnabled=!0,this.discussionEnabled=t.Delivery.DiscussionEnabled,this.discussionCacheSeconds=t.DiscussionCacheSeconds,this.lastViewingPosition=t.LastViewingPosition,this.completionPercentage=t.CompletionPercentage,this.normalizeVolume=t.Delivery.NormalizeVolume,this.activePrimary=g,this.primaryStreams=c,this.secondaryStreams=u,this.slideDecks=!y&&v.length?[a.SlideDeck(v)]:[],this.documents=P,this.thumbnails=b,this.captions=[],this.audioDescriptions=[],this.contents=C,this.channels=f,this.tags=t.Delivery.Tags,this.user={email:t.UserEmail,name:t.UserName,key:(t.UserKey||"").toLowerCase(),rating:t.UserRating,role:t.SessionRole,canCreateQuestionLists:t.UserCanCreateQuestionLists,permissions:t.Delivery.Permissions||[]},this.folder={name:t.Delivery.SessionGroupLongName,description:t.Delivery.SessionGroupAbstract,id:t.Delivery.SessionGroupPublicID},this.nextDelivery=void 0,t.Delivery.NextDeliveryUrl&&(this.nextDelivery={id:t.Delivery.NextDeliveryId,url:t.Delivery.NextDeliveryUrl,title:t.Delivery.NextDeliveryTitle,description:t.Delivery.NextDeliveryDescription,duration:Panopto.Core.TimeHelpers.formatDuration(t.Delivery.NextDeliveryDuration,Panopto.GlobalResources.TimeSeparator),thumbUrl:t.Delivery.NextDeliveryThumbUrl,isLive:t.Delivery.NextDeliveryIsLive,folderName:void 0})}parseStreams(e,i,o,a){let s=_.map(_.filter(e,(e=>"Archival"===e.StreamTypeName)),(e=>Panopto.Viewer.Data.Stream(e,o,i)));s=_.sortBy(s,"relativeStart");let n=s.length?o?_.find(s,(e=>!e.relativeEnd))||_.max(s,(e=>e.relativeEnd)):s[0]:void 0,r=o?s:n?[n]:[],l=_.map(_.filter(e,(e=>"Archival"!==e.StreamTypeName)),(e=>Panopto.Viewer.Data.Stream(e,o,i))),d=_.find(l,(e=>e.tabClass===t.Constants.ScreenCaptureClass));return a&&[...r,...l].forEach((e=>{/_hlsbc/i.test(e.url)&&(e.url=e.url.replace("master.m3u8","master2.m3u8"))})),{primaryStreams:r,secondaryStreams:l,activePrimary:n,screenCaptureStream:d}}parseEvents(t,i,o,a,s){let n=Panopto.Viewer.Data,r=_.filter(t,(e=>(e.Time||0===e.Time)&&e.Time<=a&&e.ObjectIdentifier&&e.ObjectSequenceNumber)),l=_.filter(r,(e=>"PowerPoint"===e.EventTargetType)),d=_.filter(r,(e=>e.Url)),p=[];_.each(d,(t=>p.push(new e.Viewer.Data.Document(t)))),_.each(i,(t=>p.push(new e.Viewer.Data.Document(t))));let h=_.filter(r,(e=>!e.Url&&_.contains(["ObjectVideo","Primary","SmartOcrToc"],e.EventTargetType))).concat(l);h.sort(((e,t)=>e.Time-t.Time));let c,u=_.map(h,(t=>new e.Viewer.Data.Thumbnail(t,s))).filter((e=>e.showInTableOfContents)),g=_.chain(h.concat(d)).unique().map((t=>new e.Viewer.Data.Event(t))).filter((e=>!!jQuery.trim(e.text)&&e.showInTableOfContents)).value();return o&&(c=_.map(o,(e=>n.Channel(e,e,!0)))),{slides:l,documents:p,thumbnails:u,contents:g,channels:c}}}}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Stream=function(e,t,i){var o,a=[],s=[],n=e.Name||("SCREEN"===e.Tag?Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle:Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle),r="SCREEN"===e.Tag?PanoptoTS.Viewer.Constants.ScreenCaptureClass:PanoptoTS.Viewer.Constants.ObjectVideoTabClass,l=function(e,i){var o=e-PanoptoTS.Viewer.Constants.SecondaryStreamOffset;return t||i&&o<=i+PanoptoTS.Viewer.Constants.MinSegmentGap?e:Math.max(0,o)};switch(e.RelativeSegments&&e.RelativeSegments.length?_.each(e.RelativeSegments,(function(e,t){var i=new PanoptoTS.Viewer.Data.SecondarySegment(e),o=s[t-1];i.timelineStart=l(i.relativeStart,o?o.relativeEnd:0),s.push(i),a.push(i.timelineStart,i.relativeEnd)})):(a.push(l(e.RelativeStart,void 0)),e.RelativeEnd&&a.push(e.RelativeEnd)),(o=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(n,e.PublicID,r,a,e.AbsoluteStart,"","",!1,!1,!1,t,!1)).url=e.StreamUrl,o.mediaFileType=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType,o.relativeStart=e.RelativeStart,o.relativeEnd=e.RelativeEnd,o.length=e.RelativeEnd?e.RelativeEnd-e.RelativeStart:0,o.segments=s,o.interrupted=e.Interrupted,o.deliveryTitle=i,o.broadcastSegmentDuration=e.BroadcastSegmentDuration,o.broadcastSegmentBackoff=Panopto.viewer.broadcastSegmentBackoff,o.vrType=e.VRType,o.variants=e.Variants?.map((e=>({url:e.Url,bandwidth:e.Bandwidth})))??[],Panopto.viewer.pureHlsJsPlayback&&o.vrType!==PanoptoViewer.MediaVRType.None&&PanoptoCore.Browser.isSafari&&(window.location.href=window.location.href+"&pureHlsJs=false"),e.Tag){case"AUDIO":o.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,o.isAudioOnly=!0;break;case"SCREEN":o.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen,o.isAudioOnly=!1;break;default:o.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera,o.isAudioOnly=!1}return o.optimizationToken=e.OptimizationToken,o},function(e){!function(e){!function(e){e.SecondarySegment=class{constructor(e){this.relativeStart=e.RelativeStart,this.relativeEnd=e.End?e.RelativeStart+(e.End-e.Start):1/0,this.streamOffset=e.Start}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){class t{getStreamFriendlyType(){var e;switch(this.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:e=Panopto.GlobalResources.ViewerPlus_AudioTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:e=Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:e=Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle}return e}getStreamName(){return this.name||this.getStreamFriendlyType()}static convertFromApiModel(e){var i=new t;return i.id=e.id,i.url=e.url,i.httpUrl=e.httpUrl,i.absoluteStart=e.absoluteStart,i.duration=e.duration,i.thumbnailUrlBase=e.thumbnailUrlBase,i.thumbnailInterval=e.thumbnailInterval,i.type=e.type,i.vrType=e.vrType,i.name=e.name,i.iconCode=e.iconCode,i.absoluteEnd=e.absoluteEnd(),i.streamType=e.isPrimary?1:2,i.normalizeVolume=e.normalizeVolume,i.mediaFileType=e.viewerMediaFileType,i}}e.Stream=t}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.ContentLogic=class{static getBlockingContent(e,t){return _.find(e,(e=>{let i=e.timeline[0];return e.isSessionPlaybackBlocking&&i<=t}))}static getPausingContent(e,t,i){return _.find(e,(e=>{let o=e.timeline[0];return e.pauseWhenAvailable&&o>t&&o<=i}))}}}(e.Logic||(e.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Channel=function(e,t,i){return{value:e,name:t||e,isUser:i}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},function(e){!function(e){!function(e){e.ContentHelpers=class{static createBaseContent(e,t,i,o,a,s,n,r,l,d,p,h){var c=(o=o||[])[0];return{title:e,id:t,tabClass:i,iconClass:s,iconCode:n,timeline:o,relativeStartTime:c,absoluteStartTime:a=a||c,hiddenTab:r,pauseWhenAvailable:l,isSessionPlaybackBlocking:d,isBroadcast:p,isSecondaryPaneOnly:h}}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.Document=class{constructor(e){let t=e.Url||e.URL;if(t){let e=/^.*?:\/\//;t=window.location.protocol+"//"+t.replace(e,"")}let i="number"!=typeof e.Time,o=this.constructBaseObject(e,t,i);_.extend(this,o),this.url=t,this.isPdf=i,this.isQuiz=e.IsQuestionList}constructBaseObject(t,i,o){let a=-1!==i.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl),s=t.Caption||(t.FileName?decodeURIComponent(t.FileName):a?Panopto.GlobalResources.ViewerPlus_YouTube:Panopto.GlobalResources.ViewerPlus_Website),n=t.ID||t.PublicId||t.PublicID,r=[];o?r.push(0):(r.push(t.Time),r.push(t.Time+PanoptoViewer.Constants.UrlEventDuration));let l=o?Panopto.Core.Constants.DocumentIconCode:t.IsQuestionList?Panopto.Core.Constants.QuestionListIconCode:a?void 0:Panopto.Core.Constants.LinkIconCode,d=a?e.Viewer.Constants.YouTubeIconClass:void 0;return e.Viewer.Data.ContentHelpers.createBaseContent(s,n,o?"pdf":e.Viewer.Constants.UrlTabClass,r,void 0,d,l,t.IsQuestionList,!o,t.IsSessionPlaybackBlocking,!1,!0)}}}(t.Data||(t.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){e.Event=class{constructor(e){let t=e.EventTargetType||"UserCreatedTranscript",i=e.ID||e.EventID,o=i||e.PublicId!==Panopto.Core.Constants.EmptyGuid&&e.PublicId,a=o?"event"+o:`${t}-${e.Time}`.replace(/\./gi,""),s=_.contains(["Transcript","UserCreatedTranscript"],t),n=_.contains(["ObjectVideo","Primary","PowerPoint","SmartOcrToc"],t),r=s?e.Data||e.Caption:n?e.Caption:e.Caption||e.Data,l=(e.UserName||"").toLowerCase(),d=t.replace(" ","");"Questions"===d&&(d="Comments"),this.id=a,this.eventId=i,this.eventPublicId=e.PublicId,this.sessionId=e.SessionID,this.time=e.Time,this.captionDuration=e.CaptionDuration,this.creationTime=e.CreationTime,this.text=r,this.user=l,this.userDisplayName=e.UserDisplayName||l,this.type=d,this.isQuestionList=e.IsQuestionList,this.saved=!0,this.createdDuringWebcast="Comments"===d&&e.CreatedDuringWebcast,this.url=e.Url,this.showInTableOfContents=e.ShowInTableOfContents}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Slide=function(e){return{time:e.Time,duration:e.Duration,absoluteTime:e.AbsoluteTime,queryParams:{id:e.ObjectIdentifier,number:e.ObjectSequenceNumber,x:void 0}}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.SlideDeck=function(e){var t=_.map(e,Panopto.Viewer.Data.Slide);let i=[];Panopto.features.serverAuthoritativeLeadingEvents||(t[0].time=0,i.push(t[0].time)),Panopto.features.serverAuthoritativeLeadingEvents&&t.forEach((function(e){i.push(e.time),i.push(e.time+e.duration)}));var o=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(Panopto.GlobalResources.ViewerPlus_SlidesTitle,PanoptoTS.Viewer.Constants.SlideDeckId,PanoptoTS.Viewer.Constants.SlideDeckTabClass,i,t[0].absoluteTime,"","",!1,!1,!1,!1,!1);return o.slides=t,o},function(e){!function(e){!function(e){e.TagHelper=class{static convertDeliveryToModel(e){return e.map((e=>{const t=new AutoClientModels.TagSearchItem;return t.content=e.Content,t.usageCount=e.UsageCount,t.id=e.PublicId,t}))}}}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){t.Thumbnail=class{constructor(t,i){this.time=t.Time,this.text=t.Caption,this.queryParams={eventTargetPID:t.ObjectPublicIdentifier,sessionPID:t.SessionID,number:t.ObjectSequenceNumber,isPrimary:"Primary"===t.EventTargetType||"SmartOcrToc"===t.EventTargetType,absoluteTime:t.AbsoluteTime},this.isSlide="PowerPoint"===t.EventTargetType,this.showInTableOfContents=t.ShowInTableOfContents,t.ObjectStreamID!==Panopto.Core.Constants.EmptyGuid?this.tabId=t.ObjectStreamID:this.isSlide&&(this.tabId=i?i.id:e.Viewer.Constants.SlideDeckId)}}}(t.Data||(t.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={}));
//# sourceMappingURL=file://engfs.d.panopto.com/share/jenkinsbuilds/rel_rtc_14.11.0/14.11.0.00014/_PublishedWebsites/WebUI/Scripts/Panopto/Bundles/Embed.js.map
